<!DOCTYPE html>
<html dir="ltr" lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title data-i18n="app_title">نظام كشف الحضور - كلية التمريض</title>
    <meta name="apple-mobile-web-app-title" content="SAP">

    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0ea5e9">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    <link rel="icon" href="icon-192.png" type="image/png">

    <link
        href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800;900&family=Outfit:wght@500;700;900&family=Reem+Kufi:wght@700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <link rel="stylesheet" href="style.css">

    <script src="https://unpkg.com/read-excel-file@5.x/bundle/read-excel-file.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx-js-style@1.2.0/dist/xlsx.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script defer src="./face-api.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="./advanced_archive.js" type="module"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@fingerprintjs/fingerprintjs@3/dist/fp.min.js"></script>
    <link rel="stylesheet" href="notifications.css">
    <link rel="stylesheet" href="profile-style.css">


</head>

<body>
    <div id="topToast"></div>
    <div id="verificationSuccessModal" class="modal-overlay" style="z-index: 999999;">
        <div class="modal-box">
            <i class="fa-solid fa-check-circle success-icon-large"></i>
            <div class="modal-title" style="color: #10b981; font-size: 16px;" data-i18n="verified_title">تم التحقق</div>
            <div class="modal-text" style="font-weight:bold; color:#64748b; font-size: 13px;"
                data-i18n="processing_text">جاري الفحص...</div>
            <div style="margin-top:15px;"><i class="fa-solid fa-circle-notch fa-spin" style="color:var(--primary);"></i>
            </div>
        </div>
    </div>

    <div id="bypassModal" class="modal-overlay" style="z-index: 999999;">
        <div class="modal-box">
            <i class="fa-solid fa-user-check bypass-icon"></i>
            <div class="modal-title" style="color: #10b981;" data-i18n="bypass_title">تم تجاوز التحقق</div>
            <div class="modal-text">
                <span data-i18n="bypass_desc">أنت الآن في وضع المسؤول اليدوي.</span>
                <br>
                <small style="color:#ef4444;" data-i18n="bypass_small">تم تخطي بصمة الوجه والموقع الجغرافي</small>
            </div>
        </div>
    </div>

    <div id="duplicateModal" class="modal-overlay" style="z-index: 999999;">
        <div class="modal-box">
            <i class="fa-solid fa-triangle-exclamation" style="font-size:45px; color:#f59e0b; margin-bottom:15px;"></i>
            <div class="modal-title" style="color: #f59e0b;">تنبيه</div>
            <div class="modal-text">لقد قمت بتسجيل الحضور مسبقاً في هذا المقرر اليوم.</div>
            <button onclick="document.getElementById('duplicateModal').style.display='none'"
                class="modal-btn btn-confirm" style="background:#334155;">حسناً</button>
        </div>
    </div>

    <div id="desktop-blocker">
        <i class="fa-solid fa-mobile-screen-button" style="font-size:50px; margin-bottom:20px;"></i>
        <h2 style="margin-bottom:10px">عذراً، وصول غير مصرح به</h2>
        <p>النظام متاح فقط من هواتف Android و iPhone الذكية.</p>
    </div>

    <div id="locationForceModal" class="modal-overlay" style="display:none;">
        <div class="modal-box">
            <div style="position:absolute; top:15px; left:15px;">
                <button onclick="document.getElementById('locationForceModal').style.display='none'"
                    style="background:none; border:none; color:#94a3b8; font-size:20px; cursor:pointer;"><i
                        class="fa-solid fa-xmark"></i></button>
            </div>
            <i class="fa-solid fa-location-dot fa-bounce"></i>
            <div class="modal-title">تفعيل الموقع</div>
            <div class="modal-text">يرجى تفعيل خدمة GPS للمتابعة.</div>
        </div>
    </div>

    <div class="bg-image"></div>
    <audio id="successSound" src=""></audio>
    <audio id="clickSound" src=""></audio>
    <audio id="beepSound" src=""></audio>

    <div id="customLogoutModal" class="modal-overlay">
        <div class="modal-box">
            <i class="fa-solid fa-arrow-right-from-bracket"
                style="font-size: 40px; color: #ef4444; margin-bottom: 15px;"></i>
            <div class="modal-title">تسجيل الخروج</div>
            <div class="modal-text">هل تريد الخروج من وضع المسؤول؟</div>
            <div class="modal-actions">
                <button onclick="performLogout()" class="modal-btn btn-confirm">نعم</button>
                <button onclick="closeLogoutModal()" class="modal-btn btn-cancel">إلغاء</button>
            </div>
        </div>
    </div>

    <div id="banModal" class="modal-overlay" style="z-index: 100000;">
        <div class="modal-box" style="border: 2px solid #ef4444;">
            <i class="fa-solid fa-ban" style="font-size: 50px; color: #ef4444; margin-bottom: 15px;"></i>
            <div class="modal-title" style="color: #ef4444;">تم حظرك</div>
            <div class="modal-text" style="font-weight: bold;">لقد استنفذت محاولاتك (3 مرات) أو تم اكتشاف تكرار في
                البيانات.</div>
            <button onclick="location.reload()" class="modal-btn btn-confirm" style="margin-top: 10px;">إغلاق</button>
        </div>
    </div>

    <div id="adminSuccessModal" class="modal-overlay" style="z-index: 99999;">
        <div class="modal-box">
            <i class="fa-solid fa-user-shield admin-success-icon"></i>
            <div class="modal-title" style="color: #10b981;">تم التفعيل بنجاح</div>
            <div class="modal-text">أهلاً بك في لوحة تحكم المسؤول.</div>
        </div>
    </div>

    <div id="modernConfirmModal" class="modal-overlay" style="z-index: 210000000;">
        <div class="modal-box confirm-box-style">
            <div class="confirm-icon-animate">
                <i class="fa-solid fa-trash-can"></i>
            </div>
            <div class="modal-title" id="modernConfirmTitle">تأكيد الحذف</div>
            <div class="modal-text" id="modernConfirmText">هل أنت متأكد من إتمام هذه العملية؟</div>
            <div class="modal-actions">
                <button id="btnConfirmYes" class="modal-btn btn-confirm-modern">نعم، احذف</button>
                <button onclick="closeModernConfirm()" class="modal-btn btn-cancel-modern">تراجع</button>
            </div>
        </div>
    </div>

    <div id="dataEntryModal" class="modal-overlay">
        <div class="modal-box">
            <div class="report-modal-header">
                <div class="modal-title" style="margin:0; font-size:16px;" data-i18n="data_entry_menu">قائمة إدخال
                    البيانات</div>
                <button onclick="document.getElementById('dataEntryModal').style.display='none'"
                    class="btn-close-stylish" style="width:auto; padding:5px 15px;" data-i18n="close_btn">إغلاق</button>
            </div>
            <div class="report-views-container">
                <div style="padding:15px; display:flex; flex-direction:column; gap:10px;">

                    <button class="data-entry-btn btn-manage-db" onclick="openManageStudentsModal()">
                        <i class="fa-solid fa-users-gear"></i>
                        <span>Manage Student DB</span>
                    </button>
                    <button class="data-entry-btn btn-archive" onclick="openArchiveModal()">
                        <i class="fa-solid fa-box-archive"></i>
                        <span>Attendance Archive</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="reportModal" class="modal-overlay">
        <div class="modal-box">
            <div class="report-modal-header">
                <div style="display:flex; flex-direction:column; align-items:flex-start;">
                    <div class="modal-title" style="margin:0; font-size:16px;" data-i18n="attendance_log_title">سجل
                        الحضور</div>
                    <div id="reportDateDisplay" class="en-font"
                        style="font-size:12px; color:#94a3b8; font-weight:bold;">--</div>
                </div>
                <button onclick="clearAllReport()" class="btn-icon-danger">
                    <i class="fa-solid fa-trash-can"></i>
                </button>
            </div>

            <div class="report-views-container">
                <div id="viewSubjects" class="report-view slide-in">
                    <div id="subjectsContainer"></div>
                </div>

                <div id="viewStudents" class="report-view">
                    <div class="students-list-header">
                        <button onclick="showSubjectsView()" class="btn-back-report">
                            <i class="fa-solid fa-arrow-right"></i>
                        </button>
                        <div style="display:flex; flex-direction:column; text-align:right;">
                            <span id="currentSubjectTitle"
                                style="font-weight:800; font-size:14px; color:var(--primary-dark)">--</span>
                        </div>
                        <button onclick="openReportModal()" class="btn-back-report" style="margin-right:auto;">
                            <i class="fa-solid fa-rotate-right"></i>
                        </button>
                    </div>

                    <div class="search-box-wrapper">
                        <i class="fa-solid fa-search"></i>
                        <input type="text" id="studentSearchInput" data-i18n-placeholder="search_student_placeholder"
                            placeholder="ابحث بالاسم أو الكود..." onkeyup="filterStudents()">
                    </div>

                    <div id="studentsContainer"></div>
                </div>
            </div>

            <div class="report-modal-footer">
                <button id="btnRefreshReport" onclick="openReportModal()" class="btn-refresh-list">
                    <span data-i18n="refresh_btn">تحديث</span> <i class="fa-solid fa-rotate"></i>
                </button>
                <button onclick="closeReportModal()" class="btn-close-stylish" style="margin-top:10px;"
                    data-i18n="close_btn">
                    إغلاق
                </button>
            </div>
        </div>
    </div>

    <div id="examModal" class="modal-overlay">
        <div class="modal-box">
            <div class="exam-loader"></div>
            <div class="modal-title" style="color: #7c3aed;" data-i18n="preparing_title">جاري الإعداد</div>
            <div class="modal-text" data-i18n="exam_system_notice">يتم تجهيز نظام الامتحانات حالياً...</div>
            <button onclick="closeExamModal()" class="modal-btn btn-cancel" data-i18n="close_btn">إغلاق</button>
        </div>
    </div>

    <div id="cameraErrorModal" class="modal-overlay">
        <div class="modal-box">
            <i class="fa-solid fa-camera-slash" style="font-size: 45px; color: #ef4444; margin-bottom: 15px;"></i>
            <div class="modal-title" style="color: #ef4444;" data-i18n="camera_error_title">خطأ في الكاميرا</div>
            <div class="modal-text" id="cameraErrorMsg" data-i18n="camera_error_msg">يرجى التأكد من السماح للمتصفح
                باستخدام الكاميرا من إعدادات الهاتف.</div>

            <button onclick="alert('اذهب إلى إعدادات الهاتف -> التطبيقات -> المتصفح -> الأذونات -> الكاميرا -> سماح')"
                class="modal-btn" style="background:#f1f5f9; color:#334155; margin-bottom:10px; font-size:12px;">
                <i class="fa-solid fa-gear"></i> <span data-i18n="activation_method">طريقة التفعيل</span>
            </button>

            <button onclick="retryCamera()" class="modal-btn btn-confirm" data-i18n="retry_btn">إعادة المحاولة</button>
        </div>
    </div>

    <div id="connectionLostModal" class="modal-overlay" style="z-index: 10000;">
        <div class="modal-box">
            <button class="btn-close-modal-x" onclick="hideConnectionLostModal()">
                <i class="fa-solid fa-xmark"></i>
            </button>
            <i class="fa-solid fa-wifi" style="font-size: 45px; color: #ef4444; margin-bottom: 15px;"></i>
            <div class="modal-title" style="color: #ef4444;" data-i18n="connection_lost_title">انقطع الاتصال</div>
            <div class="modal-text" data-i18n="connection_lost_msg">لا يوجد اتصال بالإنترنت.<br>جاري المحاولة...</div>
        </div>
    </div>

    <div id="toastNotification"></div>

    <div id="adminFloatingBack" class="admin-floating-back" onclick="goBackToWelcome()">
        <i class="fa-solid fa-arrow-right"></i>
    </div>
    <div class="app-card">
        <div class="card-banner"></div>

        <div id="infoBtn" class="info-btn" onclick="showInfoModal()">
            <i class="fa-solid fa-circle-info"></i>
        </div>
        <div id="infoModal" class="modal-overlay" style="z-index: 9999999;">
            <div class="modal-box info-modern-box" dir="ltr">

                <div class="heart-icon-wrapper">
                    <i class="fa-solid fa-heart"></i>
                </div>

                <h3 class="info-title-main">
                    Designed with passion
                    <span class="ar-caption-title">صُمم بكل شغف</span>
                </h3>
                <p class="info-subtitle">
                    to celebrate your presence every day
                    <span class="ar-caption-sub">للاحتفال بوجودكم معنا كل يوم</span>
                </p>

                <div class="info-content-card">

                    <div class="faculty-section">
                        <div class="faculty-icon" style="background: transparent; padding: 0;">
                            <img src="https://k.top4top.io/p_3615d3vek1.png" alt="Logo"
                                style="width: 100%; height: 100%; object-fit: contain; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));">
                        </div>
                        <div>
                            <div style="font-size: 10px; color: #94a3b8; font-weight: 700; letter-spacing: 1px;">
                                SPONSORED BY</div>
                            <div style="font-weight: 800; color: #0f172a; font-size: 15px;">Faculty of
                                Nursing</div>
                            <div style="font-size: 13px; color: #64748b;">Al-Ryada University</div>
                        </div>
                    </div>

                    <div class="dean-highlight">
                        <span class="dean-label">Under the Deanship of</span>
                        <span class="dean-name">Prof. Dr. Naglaa Abdelmawgoud</span>
                    </div>

                    <div style="margin: 20px 0; border-top: 1px dashed #e2e8f0;"></div>

                    <div class="credits-grid">
                        <div class="credit-item">
                            <div class="credit-icon icon-green">
                                <i class="fa-solid fa-user-tie"></i>
                            </div>
                            <div class="credit-info">
                                <h4>Supervision</h4>
                                <p>Dr. Mahmoud Othman</p>
                            </div>
                        </div>

                        <div class="credit-item">
                            <div class="credit-icon icon-blue">
                                <i class="fa-solid fa-code"></i>
                            </div>
                            <div class="credit-info">
                                <h4>Development</h4>
                                <p>Abdelrahman Abdelaziz</p>
                            </div>
                        </div>
                    </div>

                </div>

                <button onclick="document.getElementById('infoModal').style.display='none'" class="btn-close-modern">
                    Close
                </button>
            </div>
        </div>
        <div class="card-body">

            <div class="hero-icon-wrapper" id="heroIconWrapper">
                <img src="https://k.top4top.io/p_3615d3vek1.png" class="hero-img" id="heroImage">
                <div class="status-icon-container" id="statusIconContainer">
                    <i class="fa-solid fa-user-nurse hero-icon" id="statusIcon"></i>
                </div>
            </div>

            <div class="info-bar">
                <div class="info-pill"><i class="fa-regular fa-clock"></i> <span id="currentTime">--:--:--</span></div>
                <div class="info-pill"><i class="fa-regular fa-calendar"></i> <span id="currentDate">--/--/----</span>
                </div>
            </div>

            <div class="card-body-content">
                <div id="screenFaceCheck" class="section">
                    <button onclick="goBackToWelcome()" class="floating-back-btn">
                        <i class="fa-solid fa-arrow-right"></i>
                    </button>

                    <div style="padding-top: 20px; width: 100%; text-align: center;">
                        <h1 style="margin-bottom: 20px;">التعرف على الهوية</h1>

                        <div class="camera-wrapper"
                            style="position: relative; width: 100%; height: 50vh; background: #000; display: flex; justify-content: center; align-items: center; overflow: hidden; border-radius: 20px; margin: 0 auto; box-shadow: 0 10px 30px rgba(0,0,0,0.2);">

                            <video id="video" autoplay muted playsinline
                                style="width: 100%; height: 100%; object-fit: cover; transform: scaleX(-1);"></video>

                            <div id="loaderSpinner" class="spinner-overlay" style="display: none;">
                                <i class="fa-solid fa-user-shield large-loader-icon"></i>
                                <div class="spinner"></div>
                            </div>

                            <div class="face-overlay"
                                style="position: absolute; width: 220px; height: 220px; border: 3px solid rgba(255, 255, 255, 0.6); border-radius: 50%; box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.6);">
                            </div>
                        </div>

                        <h3 id="statusTxt" style="color:#0ea5e9; font-weight:bold; margin-top:20px; font-size: 1.2rem;">
                            جاري تشغيل الكاميرا...
                        </h3>
                        <p style="font-size:13px; color: #64748b; margin-top:5px;">
                            يرجى تثبيت وجهك داخل الإطار وعدم التحرك
                        </p>

                        <button onclick="window.goBackToWelcome()"
                            style="margin-top: 20px; background: #fee2e2; color: #ef4444; border: none; padding: 10px 20px; border-radius: 10px; font-weight: bold; cursor: pointer;">
                            إلغاء وعودة
                        </button>
                    </div>
                </div>
                <div id="screenWelcome" class="section active">
                    <div class="halo-container-v2">

                        <button id="btnLangNew" onclick="toggleSystemLanguage()" class="halo-item halo-center">
                            <i class="fa-solid fa-globe"></i>
                        </button>

                    </div>
                    <div class="faculty-title-box">
                        <span class="faculty-title-text" data-i18n="college_name">جامعة الريادة - كلية التمريض</span>
                    </div>
                    <h1 class="smart-title" data-i18n="sys_title">نظام كشف الحضور</h1>
                    <p data-i18n="welcome_subtitle">مرحباً بك. يرجى الضغط بالأسفل لتسجيل حضور المحاضرة الحالية.</p>

                    <div style="position: relative; z-index: 2;">
                        <button id="btnQuickMode" onclick="safeClick(this, toggleQuickMode)" class="btn-main"
                            style="display:none; background: #fff7ed; color: #ea580c; border: 2px dashed #f97316; margin-bottom: 10px; font-size: 14px;">
                            <div
                                style="display: flex; align-items: center; justify-content: center; gap: 10px; width: 100%;">
                                <i id="quickModeIcon" class="fa-solid fa-bolt"></i>
                                <span id="quickModeText" data-i18n="quick_mode_btn">إعدادات التسجيل السريع ⚡</span>
                            </div>
                        </button>
                        <button onclick="safeClick(this, () => startProcess(false))" class="btn-main"
                            id="mainActionBtn">
                            <span data-i18n="main_reg_btn">تسجيل الحضور</span> <i class="fa-solid fa-fingerprint"></i>
                        </button>
                        <div id="deanPrivateZone"
                            style="display:none; width: 100%; margin-top: 15px; animation: slideDown 0.5s ease-out;">

                            <div
                                style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px; padding: 0 5px;">
                                <span style="font-weight: 800; color: #1e293b; font-size: 15px;">
                                    <i class="fa-solid fa-crown" style="color: #f59e0b; margin-left: 5px;"></i>
                                    <span data-i18n="dean_zone_title">منطقة القيادة</span>
                                </span>
                                <span
                                    style="font-size: 10px; background: #e0f2fe; color: #0284c7; padding: 3px 10px; border-radius: 20px; font-weight: 700; border: 1px solid #bae6fd;"
                                    data-i18n="admin_access_badge">
                                    ADMIN ACCESS
                                </span>
                            </div>

                            <div class="dean-grid-layout"
                                style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">

                                <button onclick="openDeanOversight()" class="dean-btn-modern monitor-style">
                                    <div class="dean-icon-box"><i class="fa-solid fa-tower-broadcast fa-fade"></i></div>
                                    <div class="dean-btn-text">
                                        <span class="main-text" data-i18n="live_monitoring">المراقبة الحية</span>
                                        <span class="sub-text" data-i18n="monitoring_sub">رصد القاعات لحظياً</span>
                                    </div>
                                </button>

                                <button onclick="openDeanReports()" class="dean-btn-modern report-style">
                                    <div class="dean-icon-box"><i class="fa-solid fa-chart-pie"></i></div>
                                    <div class="dean-btn-text">
                                        <span class="main-text" data-i18n="report_management">إدارة التقارير</span>
                                        <span class="sub-text" data-i18n="analysis_sub">تحليل البيانات</span>
                                    </div>
                                </button>

                                <button class="dean-btn-modern locked-style">
                                    <div class="dean-icon-box"><i class="fa-solid fa-bell"></i></div>
                                    <div class="dean-btn-text">
                                        <span class="main-text" data-i18n="alarms">الإنذارات</span>
                                        <span class="sub-text" data-i18n="coming_soon">قريباً</span>
                                    </div>
                                </button>

                                <button onclick="openDeanSettings()" class="dean-btn-modern settings-style">
                                    <div class="dean-icon-box"><i class="fa-solid fa-sliders"></i></div>
                                    <div class="dean-btn-text">
                                        <span class="main-text" data-i18n="sys_settings">إعدادات النظام</span>
                                        <span class="sub-text" data-i18n="full_control_sub">التحكم الكامل</span>
                                    </div>
                                </button>

                            </div>
                        </div>

                        <div id="deanOversightModal" class="modal-overlay">
                            <div class="modal-box pro-oversight-box">

                                <div class="oversight-header-premium">
                                    <div class="header-top-actions">
                                        <button class="icon-circle-btn">
                                            <i class="fa-solid fa-bell"></i>
                                        </button>

                                        <button class="icon-circle-btn danger-text"
                                            onclick="document.getElementById('deanOversightModal').style.display='none'">
                                            <i class="fa-solid fa-xmark"></i>
                                        </button>
                                    </div>

                                    <div class="header-text-center">
                                        <h3 class="oversight-main-title" data-i18n="oversight_title">رادار المراقبة
                                            السيادي</h3>
                                        <p class="oversight-subtitle" data-i18n="oversight_sub">متابعة حية للمحاضرات
                                            والقاعات الآن</p>
                                    </div>
                                </div>

                                <div class="dean-stats-bar-modern">
                                    <div class="d-stat-card-modern lectures-stat">
                                        <div class="stat-icon-mini"><i class="fa-solid fa-tower-broadcast"></i></div>
                                        <div class="stat-info">
                                            <span id="totalActiveLectures">0</span>
                                            <label data-i18n="active_lectures">محاضرة جارية</label>
                                        </div>
                                    </div>
                                    <div class="d-stat-card-modern students-stat">
                                        <div class="stat-icon-mini"><i class="fa-solid fa-users"></i></div>
                                        <div class="stat-info">
                                            <span id="totalStudentsNow">0</span>
                                            <label data-i18n="present_students">طالب حاضر</label>
                                        </div>
                                    </div>
                                </div>

                                <div id="oversightLoader" class="loader-box-center">
                                    <div class="exam-loader"></div>
                                    <p data-i18n="scanning_halls">جاري مسح القاعات...</p>
                                </div>

                                <div id="oversightContainer" class="oversight-live-grid">
                                </div>

                            </div>
                        </div>

                        <div id="deanReportsModal" class="modal-overlay" style="z-index: 2147483647; display: none;">
                            <div class="modal-box dashboard-box">
                                <div class="dashboard-header">
                                    <h2 class="dash-title">
                                        <i class="fa-solid fa-file-contract"></i>
                                        <span>مركز التقارير السيادية</span>
                                    </h2>
                                    <div class="dash-actions">
                                        <button
                                            onclick="document.getElementById('deanReportsModal').style.display='none'"
                                            class="btn-close-dash">
                                            <i class="fa-solid fa-xmark"></i>
                                        </button>
                                    </div>
                                </div>

                                <div class="dashboard-controls" style="flex-direction: column; gap: 15px;">
                                    <div style="width: 100%; text-align: center; color: #64748b; margin-bottom: 10px;">
                                        حدد الفترة الزمنية لاستخراج التقرير الرسمي
                                    </div>

                                    <div style="display: flex; gap: 10px; width: 100%; justify-content: center;">
                                        <input type="date" id="reportStartDate" class="dash-input" style="width: 45%;">
                                        <span style="align-self: center; font-weight: bold;">إلى</span>
                                        <input type="date" id="reportEndDate" class="dash-input" style="width: 45%;">
                                    </div>

                                    <button onclick="generateDeanOfficialPDF()" class="btn-dash-run"
                                        style="width: 100%; margin-top: 10px; background: linear-gradient(135deg, #1e1b4b, #312e81); border: 1px solid #4338ca; cursor: pointer;">
                                        <span>Extract Official Report (PDF)</span>
                                        <i class="fa-solid fa-file-pdf"></i>
                                    </button>
                                </div>

                                <div id="dashboardContent" class="dashboard-body"
                                    style="text-align: center; padding: 40px; color: #94a3b8;">
                                    <i class="fa-solid fa-print"
                                        style="font-size: 50px; margin-bottom: 20px; opacity: 0.5;"></i>
                                    <p>سيتم تحميل ملف PDF يحتوي على (الحضور، الغياب، تقييمات الدكاترة، والمخالفات)
                                        بتنسيق رسمي.</p>
                                </div>
                            </div>
                        </div>

                        <div id="deanOversightModal" class="modal-overlay" style="z-index: 2147483647; display: none;">
                            <div class="modal-box dean-oversight-box">
                                <div class="oversight-header">
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <div class="live-indicator">LIVE</div>
                                        <h3 style="margin: 0; font-size: 16px;">الرصد اللحظي للقاعات</h3>
                                    </div>
                                    <button onclick="document.getElementById('deanOversightModal').style.display='none'"
                                        class="btn-close-stylish" style="width: auto; border:none;">&times;</button>
                                </div>

                                <div id="oversightRoomsContainer" class="oversight-scroll-area">
                                </div>
                            </div>
                        </div>
                        <div id="makaniSearchBar" class="makani-search-container" style="display: none;">
                            <div class="makani-input-wrapper">
                                <i class="fa-solid fa-location-crosshairs search-icon-main"></i>
                                <input type="text" id="makaniInput" data-i18n-placeholder="makani_placeholder"
                                    placeholder="ابحث..." onkeyup="if(event.key === 'Enter') startSmartSearch()">
                                <button onclick="startSmartSearch()" id="btnMakani">
                                    <i class="fa-solid fa-magnifying-glass"></i>
                                </button>
                            </div>
                        </div>

                        <div id="makaniResultsModal" class="modal-overlay" style="z-index: 2147483647; display: none;"
                            onclick="this.style.display='none'">
                            <div class="modal-box makani-result-box" onclick="event.stopPropagation()">
                                <div class="result-header">
                                    <i class="fa-solid fa-radar fa-spin-slow"></i>
                                    <span data-i18n="radar_results_title">نتائج رادار الكلية</span>
                                </div>
                                <div id="makaniContent">
                                </div>
                                <button onclick="document.getElementById('makaniResultsModal').style.display='none'"
                                    class="btn-close-stylish" data-i18n="close_btn">إغلاق</button>
                            </div>
                        </div>
                        <button id="btnToggleSession" onclick="safeClick(this, toggleSessionState)" class="btn-main"
                            style="display:none; background: #e2e8f0; color: #475569; border: 2px solid #cbd5e1; margin-bottom: 15px; margin-top: 10px;">
                            <div
                                style="display: flex; align-items: center; justify-content: center; gap: 10px; width: 100%;">
                                <i id="sessionIcon" class="fa-solid fa-lock"></i>
                                <span id="sessionText">Checking status...</span>
                            </div>
                        </button>
                        <div class="admin-controls-grid">
                            <button id="btnAdminLogin" onclick="handleAdminTripleClick(this)"
                                class="admin-sub-btn btn-admin-login">
                                <i class="fa-solid fa-user-doctor sub-btn-icon"></i>
                                <span data-i18n="faculty_portal">بوابة الدكاترة</span>
                            </button>

                            <button id="btnViewReport" onclick="handleReportClick()"
                                class="admin-sub-btn btn-report locked">
                                <i id="reportIcon" class="fa-solid fa-list-check sub-btn-icon"></i>
                                <span data-i18n="attendance_report">سجل الحضور</span>
                            </button>

                            <button id="btnToolsRequest" onclick="openToolsRequestModal()"
                                class="admin-sub-btn btn-tools"
                                style="background: #ecfdf5; color: #047857; border-color: #a7f3d0; display: none;">
                                <i class="fa-solid fa-briefcase-medical sub-btn-icon"></i>
                                <span data-i18n="tools_request">طلب تجهيزات</span>
                            </button>
                            <button id="btnLiveFeedback" onclick="openFeedbackStats()"
                                class="admin-sub-btn btn-feedback-static" style="display: none;">
                                <i class="fa-solid fa-star sub-btn-icon"></i>
                                <span id="badgeFeedbackCount" class="feedback-badge-static"
                                    style="display:none;">0</span>
                                <span data-i18n="feedback_btn">التقييمات</span>
                            </button>
                            <button onclick="openExamModal()" class="admin-sub-btn btn-exams">
                                <i class="fa-solid fa-file-pen sub-btn-icon"></i>
                                <span style="font-size: 13px;" data-i18n="exam_management">تنظيم الامتحانات</span>
                            </button>

                            <button onclick="safeClick(this, () => location.reload())"
                                class="admin-sub-btn btn-refresh">
                                <i class="fa-solid fa-arrows-rotate sub-btn-icon" style="font-size: 22px;"></i>
                            </button>

                            <button onclick="openDataEntryMenu()" class="admin-sub-btn btn-data-entry" id="btnDataEntry"
                                style="display:none;">
                                <i class="fa-solid fa-database sub-btn-icon"></i>
                                <span data-i18n="data_entry">إدخال البيانات</span>
                            </button>
                        </div>

                        <div id="installAppPrompt" class="install-prompt-box" onclick="triggerAppInstall()">
                            <div class="install-icon-box"><i class="fa-solid fa-download"></i></div>
                            <div class="install-text-col">
                                <div class="install-title" data-i18n="install_app">تثبيت التطبيق</div>
                                <div class="install-subtitle" data-i18n="install_app_sub">أضف النظام للشاشة الرئيسية
                                </div>
                            </div>
                            <i class="fa-solid fa-chevron-left" style="font-size:12px; color:#64748b;"></i>
                        </div>
                        <div class="academic-footer">
                        </div>
                    </div>

                </div>
                <div id="screenAdminLogin" class="section">
                    <h1 data-i18n="admin_login_title">دخول المسؤول</h1>
                    <p data-i18n="admin_login_sub">أدخل بيانات الحساب الإداري.</p>
                    <div id="adminAlert" style="display:none;" class="alert-box"></div>

                    <div class="input-group">
                        <input type="email" id="adminEmailInput" class="modern-input"
                            data-i18n-placeholder="email_placeholder" placeholder="البريد الإلكتروني"
                            style="margin-bottom: 10px; direction: ltr;" required>

                        <div style="position: relative; width: 100%;">
                            <input type="password" id="adminPassword" class="modern-input"
                                data-i18n-placeholder="password_placeholder" placeholder="كلمة المرور"
                                style="padding-left: 45px;" required>

                            <i class="fa-solid fa-eye" id="eyeIcon" onclick="togglePasswordVisibility()"
                                style="position: absolute; left: 15px; top: 50%; transform: translateY(-50%); cursor: pointer; color: #94a3b8; font-size: 18px; z-index: 10;">
                            </i>
                        </div>
                    </div>

                    <button onclick="checkAdminPassword()" class="btn-main">
                        <span data-i18n="activate_btn">تفعيل</span> <i class="fa-solid fa-key"></i>
                    </button>
                    <button onclick="goBackToWelcome()" class="btn-back-modern">
                        <span data-i18n="back_home_btn">العودة للصفحة الرئيسية</span>
                        <i class="fa-solid fa-arrow-left"></i>
                    </button>
                </div>
                <div id="screenLoading" class="section">
                    <h1 style="margin-top: 10px;">جاري التحقق...</h1>
                    <i class="fa-solid fa-circle-notch fa-spin"
                        style="font-size:40px; color:var(--primary); margin: 20px 0;"></i>
                    <p>يرجى السماح للمتصفح بتحديد موقعك الجغرافي.</p>

                    <button onclick="openMapsToRefreshGPS()" class="btn-google-maps" style="margin-top: 20px;">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/a/aa/Google_Maps_icon_%282020%29.svg"
                            class="maps-icon-img" alt="Maps">
                        <span>فتح الخريطة (لتنشيط GPS)</span>
                    </button>
                </div>

                <div id="screenReadyToStart" class="section">
                    <div style="margin: 30px 0;">
                        <i class="fa-solid fa-map-location-dot"
                            style="font-size: 60px; color: #10b981; animation: popUp 0.5s;"></i>
                    </div>
                    <h1 style="color: #10b981;">الموقع مطابق</h1>
                    <p>تم التحقق من تواجدك في الكلية بنجاح.</p>

                    <button onclick="switchScreen('screenDataEntry')" class="btn-main" style="margin-top: 10px;"> سجل
                        الآن <i class="fa-solid fa-arrow-left"></i></button>
                </div>

                <div id="screenDataEntry" class="section">
                    <button onclick="goBackToWelcome()" class="floating-back-btn" style="display: none;">
                        <i class="fa-solid fa-arrow-right"></i>
                    </button>

                    <div
                        style="display: flex; flex-direction: column; align-items: center; justify-content: flex-start; padding-top: 10px; min-height: 80vh;">

                        <div
                            style="background: white; padding: 20px 25px 30px 25px; border-radius: 24px; box-shadow: 0 10px 40px rgba(0,0,0,0.08); width: 90%; max-width: 360px; text-align: center; position: relative; margin-top: 10px;">

                            <div id="step1_search" class="minimal-join-container">
                                <div class="top-status-icon">
                                    <div class="icon-glow"></div>
                                    <i class="fa-solid fa-bolt-lightning"></i>
                                </div>
                                <div class="header-content-center">
                                    <h2 class="auth-main-title" data-i18n="search_header">SESSION</h2>
                                </div>
                                <div class="pin-input-wrapper">
                                    <div class="floating-group tech-input-glass">
                                        <input type="text" id="attendanceCode" class="floating-input en-font pin-field"
                                            placeholder=" " inputmode="numeric" maxlength="6"
                                            oninput="this.value = this.value.replace(/[^0-9]/g, '');" required>
                                        <label class="floating-label" data-i18n="pin_label">6-DIGIT PIN</label>
                                    </div>
                                </div>
                                <button id="btnSearchSession" onclick="searchForSession()"
                                    class="tech-link-btn join-style">
                                    <span class="btn-text" data-i18n="join_now_btn">JOIN NOW</span>
                                    <div class="btn-icon-circle"><i class="fa-solid fa-arrow-right-to-bracket"></i>
                                    </div>
                                </button>
                                <p class="minimal-hint">ENTER THE 6-DIGIT CODE FROM YOUR DOCTOR</p>
                            </div>

                            <div id="step2_auth" style="display: none; animation: fadeIn 0.5s ease-out; width: 100%;">

                                <div id="authCountdownBox"
                                    style="display: flex; justify-content: center; margin-top: 10px; margin-bottom: 20px;">
                                    <div class="auth-timer-pill"
                                        style="background: #ecfdf5; border-color: #10b981; color: #047857;">
                                        <i class="fa-solid fa-clock fa-spin-slow"></i>
                                        <span id="authTimerDisplay">--:--</span>
                                    </div>
                                </div>

                                <div class="royal-session-card" style="padding-bottom: 25px;">
                                    <div class="r-card-accent"></div>
                                    <div class="r-avatar-area">
                                        <div class="r-avatar-glow"></div>
                                        <div class="r-avatar-inner" id="foundDocAvatar">
                                            <i class="fa-solid fa-user-doctor"></i>
                                        </div>
                                    </div>

                                    <div class="r-info-content">
                                        <span class="r-label-tag">CURRENT LECTURER</span>

                                        <h3 id="foundDocName" class="r-doctor-name" style="margin-bottom: 5px;">Dr. Name
                                        </h3>

                                        <h4 id="foundSubjectName" class="r-subject-title"
                                            style="font-size: 18px; line-height: 1.6; margin-top: 10px; color: #0077b6; font-weight: 800; white-space: normal;">
                                            --
                                        </h4>
                                    </div>
                                </div>

                                <div class="auth-input-zone" style="margin-top: 25px;">
                                    <div class="floating-group">
                                        <i class="fa-solid fa-lock icon-inside"></i>
                                        <input type="text" id="sessionPass" class="floating-input en-font"
                                            placeholder=" " required>
                                        <label class="floating-label">Session Password</label>
                                    </div>
                                </div>

                                <div class="auth-action-area">
                                    <button id="btnJoinFinal" onclick="joinSessionAction()"
                                        class="btn-main join-btn-premium">
                                        Confirm & Join <i class="fa-solid fa-door-open"></i>
                                    </button>

                                    <div class="dual-buttons-row">
                                        <button onclick="goBackToWelcome()" class="btn-secondary-outline">
                                            <i class="fa-solid fa-house"></i> Home
                                        </button>
                                        <button onclick="resetSearchSession()" class="btn-secondary-outline">
                                            <i class="fa-solid fa-magnifying-glass"></i> Search Again
                                        </button>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
            <div id="manageUploadsModal" class="modal-overlay" style="z-index: 200000000;">
                <div class="modal-box">
                    <div class="report-modal-header">
                        <div class="modal-title" style="margin:0; font-size:16px;">سجل الملفات المرفوعة</div>
                        <button onclick="document.getElementById('manageUploadsModal').style.display='none'"
                            class="btn-close-stylish" style="width:auto; padding:5px 15px;">إغلاق</button>
                    </div>
                    <div class="report-views-container">
                        <div style="padding:15px; overflow-y:auto; height:100%;">
                            <div id="uploadsHistoryContainer">
                                <div style="text-align:center; padding:20px;"><i
                                        class="fa-solid fa-spinner fa-spin"></i> جاري
                                    التحميل...</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="manageStudentsModal" class="modal-overlay" style="z-index: 200000000;">

                <div class="modal-box" style="background: #f8fafc; padding: 0; overflow: hidden;">

                    <div class="report-modal-header">
                        <div class="modal-title" style="margin:0; font-size:16px; color:#0f172a;">إدارة بيانات الطلاب
                        </div>
                        <button onclick="closeManageStudentsModal()" class="btn-close-stylish"
                            style="width:auto; padding:5px 15px;">إغلاق</button>
                    </div>

                    <div class="report-views-container" style="padding: 20px;">

                        <div class="modern-card-action">
                            <div class="card-label"><i class="fa-solid fa-layer-group"></i> الخطوة الأولى: تحديد الفرقة
                            </div>
                            <div class="modern-select-wrapper">
                                <select id="uploadLevelSelect" class="modern-select-input">
                                    <option value="" disabled selected>-- اضغط لاختيار الفرقة --</option>
                                    <option value="1">الفرقة الأولى</option>
                                    <option value="2">الفرقة الثانية</option>
                                    <option value="3">الفرقة الثالثة</option>
                                    <option value="4">الفرقة الرابعة</option>
                                </select>
                                <i class="fa-solid fa-chevron-down select-arrow"></i>
                            </div>
                        </div>

                        <div class="modern-card-action"
                            style="margin-top: 15px; border-color: #bbf7d0; background: #f0fdf4;">
                            <div class="card-label" style="color: #166534;"><i class="fa-solid fa-cloud-arrow-up"></i>
                                الخطوة
                                الثانية: رفع الملف</div>
                            <input type="file" id="excelFileInput" style="display: none;" accept=".xlsx, .xls" />
                            <button onclick="triggerUploadProcess()" class="btn-action-modern upload-btn">
                                اختر ملف Excel <i class="fa-solid fa-file-excel"></i>
                            </button>
                            <div id="uploadStatus"
                                style="font-size: 11px; text-align: center; margin-top: 8px; color: #166534; font-weight:bold; min-height: 15px;">
                            </div>
                        </div>

                        <div class="separator-line">أو</div>

                        <button onclick="openUploadHistory()" class="btn-history-modern">
                            <i class="fa-solid fa-clock-rotate-left"></i> عرض السجل / حذف شيت سابق
                        </button>

                    </div>
                    <div class="separator-line">نتائج الامتحانات</div>

                    <div class="modern-card-action" style="border-color: #bfdbfe; background: #eff6ff;">
                        <div class="card-label" style="color: #1e40af;">
                            <i class="fa-solid fa-graduation-cap"></i> رفع نتائج (كويز / ميدتيرم)
                        </div>

                        <input type="text" id="examSubjectName" class="modern-input"
                            placeholder="اسم المادة (مثال: تشريح)"
                            style="background: white !important; color: #1e293b !important; margin-bottom: 10px; border: 1px solid #cbd5e1;">

                        <div class="modern-select-wrapper" style="margin-bottom: 10px;">
                            <select id="examTypeSelect" class="modern-select-input"
                                style="background: white !important; color: #1e293b !important;">
                                <option value="Quiz">Quiz (كويز)</option>
                                <option value="Midterm">Midterm (ميدتيرم)</option>
                                <option value="Final">Final (فاينل)</option>
                            </select>
                            <i class="fa-solid fa-chevron-down select-arrow" style="color: #1e293b;"></i>
                        </div>

                        <input type="file" id="examSheetInput" style="display: none;" accept=".xlsx, .xls" />
                        <button onclick="triggerExamUpload()" class="btn-action-modern" style="background: #3b82f6;">
                            رفع شيت الدرجات <i class="fa-solid fa-file-csv"></i>
                        </button>

                        <div id="examUploadStatus"
                            style="font-size: 11px; text-align: center; margin-top: 8px; color: #1e40af; font-weight:bold; min-height: 15px;">
                        </div>
                    </div>
                </div>

            </div>
            <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

            <script type="module" src="js/core/utils.js"></script>
            <script type="module" src="./setup.js"></script>
            <script type="module" src="security.js"></script>
            <script type="module" src="script.js"></script>
            <script type="module" src="admin-session.js"></script>
            <script type="module" src="face-system.js"></script>
            <script type="module" src="profile-system.js"></script>
            <script type="module" src="reports-module.js"></script>

            <div id="attendanceRecordsModal" class="modal-overlay" style="z-index: 200000000;">
                <div class="modal-box">
                    <div class="report-modal-header">
                        <div class="modal-title" style="margin:0; font-size:16px;">أرشيف السجلات</div>
                        <button onclick="document.getElementById('attendanceRecordsModal').style.display='none'"
                            class="btn-close-stylish" style="width:auto; padding:5px 15px;">إغلاق</button>
                    </div>

                    <div class="report-views-container" style="padding: 20px;">

                        <label style="display:block; margin-bottom:10px; font-weight:bold; color:#1e293b;">نوع
                            التقرير:</label>
                        <div class="segment-control"
                            style="margin-bottom: 15px; display:flex; background:#f1f5f9; padding:4px; border-radius:10px;">
                            <input type="radio" name="reportType" id="repDaily" value="daily" checked
                                style="display:none;" onchange="toggleDateLabel()">
                            <label for="repDaily"
                                style="flex:1; text-align:center; padding:8px; cursor:pointer; border-radius:8px; font-size:13px; font-weight:bold; transition:0.3s;"
                                id="lblDaily">يوم محدد</label>

                            <input type="radio" name="reportType" id="repWeekly" value="weekly" style="display:none;"
                                onchange="toggleDateLabel()">
                            <label for="repWeekly"
                                style="flex:1; text-align:center; padding:8px; cursor:pointer; border-radius:8px; font-size:13px; font-weight:bold; transition:0.3s;"
                                id="lblWeekly">أسبوع كامل</label>
                        </div>

                        <label id="dateInputLabel"
                            style="display:block; margin-bottom:5px; font-weight:bold; color:#1e293b;">تاريخ
                            المحاضرة:</label>
                        <input type="date" id="historyDateInput" class="modern-input"
                            style="width:100%; margin-bottom:15px;">

                        <label style="display:block; margin-bottom:5px; font-weight:bold; color:#1e293b;">الفرقة
                            الدراسية:</label>
                        <div class="modern-select-wrapper" style="margin-bottom:15px;">
                            <select id="archiveLevelSelect" class="modern-select-input"
                                onchange="clearSearchBox(); updateArchiveSubjects()">
                                <option value="" disabled selected>-- اختر الفرقة --</option>
                                <option value="1">الفرقة الأولى</option>
                                <option value="2">الفرقة الثانية</option>
                                <option value="3">الفرقة الثالثة</option>
                                <option value="4">الفرقة الرابعة</option>
                            </select>
                            <i class="fa-solid fa-chevron-down select-arrow"></i>
                        </div>

                        <label style="display:block; margin-bottom:5px; font-weight:bold; color:#1e293b;">
                            اسم المادة:
                        </label>

                        <div style="position: relative; margin-bottom:20px;">
                            <input type="text" id="archiveSubjectInput" class="modern-input" list="subjectsList"
                                placeholder="اكتب للبحث (أ = ا)..." style="width:100%;" oninput="smartSubjectSearch()"
                                onfocus="smartSubjectSearch()">

                            <datalist id="subjectsList"></datalist>

                            <div id="suggestionBox"
                                style="display:none; position:absolute; top:100%; left:0; right:0; background:white; border:1px solid #cbd5e1; border-radius:0 0 8px 8px; max-height:150px; overflow-y:auto; z-index:1000; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);">
                            </div>
                        </div>

                        <button onclick="downloadHistoricalSheet()" class="btn-main"
                            style="background: linear-gradient(135deg, #0ea5e9, #0284c7);">
                            تحميل السجل <i class="fa-solid fa-cloud-arrow-down"></i>
                        </button>

                    </div>
                </div>
            </div>

            <style>
                input[name="reportType"]:checked+label {
                    background: #fff;
                    color: #0ea5e9;
                    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
                }

                input[name="reportType"]:not(:checked)+label {
                    color: #64748b;
                }
            </style>
            <div id="secureLoginModal" class="modal-overlay">
                <div class="modal-box" style="max-width: 400px;">
                    <div class="report-modal-header">
                        <div class="modal-title" data-i18n="admin_login_title">🔐 دخول المشرفين</div>
                        <button onclick="document.getElementById('secureLoginModal').style.display='none'"
                            class="btn-close-stylish" data-i18n="close_btn">إغلاق</button>
                    </div>

                    <div style="padding: 20px;">
                        <label style="display:block; margin-bottom:5px; font-weight:bold;"
                            data-i18n="email_label">البريد الإلكتروني الموحد:</label>
                        <input type="email" id="adminEmail" class="modern-input"
                            data-i18n-placeholder="email_placeholder" placeholder="admin@nursing.com"
                            style="width:100%; margin-bottom:15px; direction:ltr;">

                        <label style="display:block; margin-bottom:5px; font-weight:bold;"
                            data-i18n="password_label">كلمة المرور:</label>
                        <input type="password" id="adminPass" class="modern-input"
                            data-i18n-placeholder="password_placeholder" placeholder="********"
                            style="width:100%; margin-bottom:20px; direction:ltr;">

                        <button onclick="performSecureLogin()" class="btn-main" style="width:100%;"
                            data-i18n="login_btn">تسجيل الدخول</button>
                    </div>
                </div>
            </div>
            <div id="sessionTimeModal" class="modal-overlay" style="z-index: 9999999;">
                <div class="modal-box" style="width: 90%; max-width: 350px; padding: 20px;">
                    <div class="modal-title" style="margin-bottom: 15px;" data-i18n="choose_duration_title">⏱️ اختر
                        مدة
                        الجلسة</div>

                    <div class="time-grid-modern">
                        <button onclick="confirmSessionStart(10)" class="time-btn" data-i18n="time_10s">10
                            ثواني</button>
                        <button onclick="confirmSessionStart(20)" class="time-btn" data-i18n="time_20s">20
                            ثانية</button>
                        <button onclick="confirmSessionStart(30)" class="time-btn" data-i18n="time_30s">30
                            ثانية</button>
                        <button onclick="confirmSessionStart(40)" class="time-btn" data-i18n="time_40s">40
                            ثانية</button>
                        <button onclick="confirmSessionStart(50)" class="time-btn" data-i18n="time_50s">50
                            ثانية</button>
                        <button onclick="confirmSessionStart(60)" class="time-btn" data-i18n="time_1m">1
                            دقيقة</button>
                        <button onclick="confirmSessionStart(120)" class="time-btn" data-i18n="time_2m">2
                            دقيقة</button>
                        <button onclick="confirmSessionStart(-1)" class="time-btn open-time"
                            data-i18n="open_time_btn">🔓 وقت مفتوح</button>
                    </div>

                    <button onclick="document.getElementById('sessionTimeModal').style.display='none'"
                        class="btn-cancel-modern" style="margin-top: 15px; width: 100%;"
                        data-i18n="cancel_btn">إلغاء</button>
                </div>
            </div>

            <style>
                .time-grid-modern {
                    display: grid;
                    grid-template-columns: repeat(2, 1fr);
                    gap: 10px;
                }

                .time-btn {
                    background: #f1f5f9;
                    border: 1px solid #cbd5e1;
                    border-radius: 8px;
                    padding: 12px;
                    font-weight: bold;
                    color: #334155;
                    cursor: pointer;
                    transition: 0.2s;
                }

                .time-btn:active {
                    transform: scale(0.95);
                }

                .time-btn.open-time {
                    grid-column: span 2;
                    background: #dcfce7;
                    color: #166534;
                    border-color: #86efac;
                }
            </style>
            <div id="customTimeModal" class="sys-modal-overlay"
                style="display: none; z-index: 2147483647; align-items: center; justify-content: center;">

                <div class="sys-modal-box"
                    style="width: 90%; max-width: 380px; background: #fff; border-radius: 24px; overflow: hidden; display: flex; flex-direction: column; box-shadow: 0 20px 50px rgba(0,0,0,0.2);">

                    <div style="padding: 20px 20px 10px 20px; text-align: center;">
                        <div
                            style="width: 50px; height: 50px; background: #e0f2fe; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 10px auto;">
                            <i class="fa-solid fa-sliders" style="color: #0ea5e9; font-size: 24px;"></i>
                        </div>
                        <h3 style="margin: 0; color: #0f172a; font-size: 18px; font-weight: 800;"
                            data-i18n="setup_lecture_title">Setup Lecture</h3>
                    </div>

                    <div style="padding: 0 20px 25px 20px; overflow-y: auto; max-height: 70vh;">

                        <div style="margin-bottom: 15px;">
                            <label class="setup-label" data-i18n="setup_subject_label">Subject</label>
                            <div class="smart-picker-container">
                                <div class="search-row">
                                    <i class="fa-solid fa-magnifying-glass search-icon"></i>
                                    <input type="text" id="setupSubjectSearchInput" class="picker-search"
                                        data-i18n-placeholder="subject_search_placeholder" placeholder="Search..."
                                        oninput="filterCustomList('subjectList', this.value)">
                                </div>
                                <div id="subjectList" class="custom-list-box">
                                    <div style="padding:10px; color:#94a3b8; text-align:center;">Loading...</div>
                                </div>
                                <input type="hidden" id="finalSubjectValue">
                            </div>
                        </div>

                        <div style="margin-bottom: 15px;">
                            <label class="setup-label" data-i18n="setup_hall_label">Hall</label>
                            <div class="smart-picker-container">
                                <div class="search-row">
                                    <i class="fa-solid fa-building-columns search-icon"></i>
                                    <input type="text" id="setupHallSearchInput" class="picker-search"
                                        data-i18n-placeholder="hall_search_placeholder" placeholder="Search Hall..."
                                        oninput="filterCustomList('hallList', this.value)">
                                </div>
                                <div id="hallList" class="custom-list-box">
                                    <div style="padding:10px; color:#94a3b8; text-align:center;">Loading...</div>
                                </div>
                                <input type="hidden" id="finalHallValue">
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 15px;">
                            <div>
                                <label class="setup-label">
                                    <span data-i18n="setup_group_label">Group</span>
                                    <span
                                        style="font-size: 11px; color: #ef4444; font-weight: 800; margin-left: 5px;">(e.g.
                                        1G1)</span>
                                </label>
                                <input type="text" id="modalGroupInput" class="simple-input" placeholder=" ">
                            </div>
                            <div>
                                <label class="setup-label" data-i18n="session_pass_label">Password</label>
                                <input type="text" id="modalSessionPassInput" class="simple-input" placeholder="----">
                            </div>
                        </div>

                        <div style="margin-top: 25px; display: flex; flex-direction: column; gap: 10px;">
                            <button onclick="confirmSessionStart()" class="btn-start-action">
                                <span data-i18n="start_setup_btn">Start Lecture</span>
                            </button>
                            <button onclick="closeSetupModal()" class="btn-cancel-simple" data-i18n="cancel_btn">
                                Cancel
                            </button>
                        </div>

                    </div>
                </div>
            </div>
            <div id="studentPassModal" class="modal-overlay" style="z-index: 99999999;">
                <div class="modal-box">
                    <i class="fa-solid fa-key" style="font-size: 40px; color: #f59e0b; margin-bottom: 15px;"></i>
                    <div class="modal-title" style="color: #1e293b;" data-i18n="session_password_title">كلمة سر
                        الجلسة
                    </div>
                    <div class="modal-text" data-i18n="session_protected_msg">هذه الجلسة محمية بكلمة مرور. يرجى
                        إدخالها
                        للمتابعة.</div>

                    <input type="text" id="studentEnteredPass" class="modern-input"
                        data-i18n-placeholder="enter_code_placeholder" placeholder="اكتب الرمز هنا"
                        style="text-align: center; font-size: 20px; letter-spacing: 3px; font-weight: bold; margin-bottom: 15px;">

                    <button onclick="verifyAndSubmit()" class="btn-main" style="background: #0ea5e9;">
                        <span data-i18n="confirm_btn">تأكيد</span> <i class="fa-solid fa-check"></i>
                    </button>
                </div>
            </div>
            <div id="studentFloatingTimer" class="floating-timer" style="display: none;">
                <div class="timer-icon-pulse">
                    <i class="fa-solid fa-hourglass-half"></i>
                </div>
                <span id="floatingTimeText" class="en-font">00</span>
            </div>
            <div id="quickModeOptionsModal" class="modal-overlay" style="z-index: 999999; display: none;">
                <div class="modal-box">
                    <div class="modal-title" style="color: #ea580c; display: flex; align-items: center; gap: 10px;">
                        <i class="fa-solid fa-sliders"></i> تخصيص القيود
                    </div>
                    <p style="color: #64748b; font-size: 13px; margin-bottom: 20px;">
                        حدد القيود التي تريد <b>تعطيلها (إلغاءها)</b> لتسهيل دخول الطلاب:
                    </p>

                    <div class="options-list" style="text-align: right;">
                        <label class="option-row"
                            style="display: flex; align-items: center; justify-content: space-between; padding: 15px; border: 1px solid #e2e8f0; border-radius: 10px; margin-bottom: 10px; cursor: pointer;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <i class="fa-solid fa-location-slash" style="color: #0ea5e9;"></i>
                                <span style="font-weight: bold; color: #334155;">إلغاء الموقع (GPS)</span>
                            </div>
                            <input type="checkbox" id="chkDisableGPS"
                                style="width: 20px; height: 20px; accent-color: #ea580c;">
                        </label>

                        <label class="option-row"
                            style="display: flex; align-items: center; justify-content: space-between; padding: 15px; border: 1px solid #e2e8f0; border-radius: 10px; margin-bottom: 10px; cursor: pointer;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <i class="fa-solid fa-user-slash" style="color: #8b5cf6;"></i>
                                <span style="font-weight: bold; color: #334155;">إلغاء بصمة الوجه</span>
                            </div>
                            <input type="checkbox" id="chkDisableFace"
                                style="width: 20px; height: 20px; accent-color: #ea580c;">
                        </label>

                        <label class="option-row"
                            style="display: flex; align-items: center; justify-content: space-between; padding: 15px; border: 1px solid #e2e8f0; border-radius: 10px; margin-bottom: 10px; cursor: pointer;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <i class="fa-solid fa-qrcode" style="color: #10b981;"></i>
                                <span style="font-weight: bold; color: #334155;" data-i18n="disable_qr_label">إلغاء
                                    كود
                                    QR</span>
                            </div>
                            <input type="checkbox" id="chkDisableQR"
                                style="width: 20px; height: 20px; accent-color: #ea580c;">
                        </label>
                    </div>

                    <div class="modal-actions"
                        style="margin-top: 20px; display: flex; flex-direction: column; gap: 10px;">
                        <button onclick="confirmQuickModeParams()" class="btn-main"
                            style="background: #ea580c; width: 100%;" data-i18n="activate_selected_btn">تفعيل المحدد
                            ✅</button>
                        <button onclick="disableQuickMode()" class="btn-cancel-modern"
                            style="color: #ef4444; border-color: #fee2e2; background: #fef2f2; width: 100%;"
                            data-i18n="stop_quick_mode_btn">إيقاف الوضع
                            السريع</button>
                        <button onclick="document.getElementById('quickModeOptionsModal').style.display='none'"
                            class="btn-cancel-modern" style="width: 100%;" data-i18n="close_btn">إغلاق</button>
                    </div>
                </div>
            </div>
            <div id="studentAuthDrawer" class="auth-drawer-overlay"
                onclick="if(event.target == this) closeAuthDrawer()">
                <div class="auth-drawer-content modern-glass">

                    <button onclick="closeAuthDrawer()" class="close-btn-modern" aria-label="Close">
                        <i class="fa-solid fa-xmark"></i>
                    </button>

                    <div class="header-content-center">
                        <h2 id="authTitle" class="auth-main-title">Welcome Back</h2>
                        <p id="authSubtitle" class="auth-sub-title">Please enter your details to continue</p>
                    </div>

                    <div class="drawer-body">

                        <div id="loginSection" class="auth-section active">
                            <div class="floating-group">
                                <i class="fa-solid fa-envelope icon-inside"></i>
                                <input type="email" id="studentLoginEmail" class="floating-input" placeholder=" "
                                    required>
                                <label class="floating-label">University Email</label>
                            </div>
                            <div class="floating-group">
                                <i class="fa-solid fa-lock icon-inside"></i>
                                <input type="password" id="studentLoginPass" class="floating-input" placeholder=" "
                                    required>
                                <label class="floating-label">Password</label>
                                <i class="fa-solid fa-eye eye-toggle"
                                    onclick="togglePass('studentLoginPass', this)"></i>
                            </div>
                            <button onclick="performStudentLogin()" class="btn-modern-action">Sign In</button>
                            <p class="switch-link-center">New student? <a href="javascript:void(0)"
                                    onclick="toggleAuthMode('signup')">Create Account</a></p>
                        </div>

                        <div id="signupSection" class="auth-section">
                            <div class="floating-group">
                                <i class="fa-solid fa-id-card icon-inside"></i>
                                <input type="number" id="regStudentID" class="floating-input" placeholder=" "
                                    oninput="autoFetchName(this.value)" required>
                                <label class="floating-label">University ID</label>
                            </div>

                            <div class="floating-group">
                                <i class="fa-solid fa-user-graduate icon-inside"></i>
                                <input type="text" id="regFullName" class="floating-input readonly-input"
                                    placeholder=" " readonly>
                                <label class="floating-label">Full Name</label>
                                <div id="nameLoader" class="loader-inside"><i
                                        class="fa-solid fa-circle-notch fa-spin"></i>
                                </div>
                            </div>

                            <div class="form-row-pro">
                                <div class="floating-group custom-dropdown icon-only-dropdown" id="dropdownLevel">
                                    <div class="custom-select-display" onclick="toggleDropdown('listLevel')">
                                        <i class="fa-solid fa-graduation-cap icon-main"></i>
                                        <i class="fa-solid fa-caret-down mini-arrow"></i>
                                    </div>
                                    <ul class="dropdown-list" id="listLevel">
                                        <li onclick="selectOption('Level', '1', '1st Year')">First Year (1st)
                                        </li>
                                        <li onclick="selectOption('Level', '2', '2nd Year')">Second Year (2nd)
                                        </li>
                                        <li onclick="selectOption('Level', '3', '3rd Year')">Third Year (3rd)
                                        </li>
                                        <li onclick="selectOption('Level', '4', '4th Year')">Fourth Year (4th)
                                        </li>
                                    </ul>
                                    <input type="hidden" id="regLevel" value="">
                                </div>

                                <div class="floating-group custom-dropdown icon-only-dropdown" id="dropdownGender">
                                    <div class="custom-select-display" onclick="toggleDropdown('listGender')">
                                        <i class="fa-solid fa-venus-mars icon-main"></i>
                                        <i class="fa-solid fa-caret-down mini-arrow"></i>
                                    </div>
                                    <ul class="dropdown-list" id="listGender">
                                        <li onclick="selectOption('Gender', 'Male', 'Male')">Male</li>
                                        <li onclick="selectOption('Gender', 'Female', 'Female')">Female</li>
                                    </ul>
                                    <input type="hidden" id="regGender" value="">
                                </div>
                            </div>

                            <div class="floating-group">
                                <i class="fa-solid fa-users-rectangle icon-inside"></i>
                                <input type="text" id="regGroup" class="floating-input" placeholder=" " required
                                    oninput="validateSignupForm()">
                                <label class="floating-label">Group (e.g. G12)</label>
                            </div>

                            <div class="floating-group">
                                <i class="fa-solid fa-at icon-inside"></i>
                                <input type="email" id="regEmail" class="floating-input" placeholder=" " required
                                    oninput="validateSignupForm()">
                                <label class="floating-label">University Email</label>
                            </div>
                            <div class="floating-group">
                                <i class="fa-solid fa-envelope-circle-check icon-inside"></i>
                                <input type="email" id="regEmailConfirm" class="floating-input" placeholder=" " required
                                    oninput="validateSignupForm()">
                                <label class="floating-label">Confirm Email</label>
                                <small id="emailError" class="error-text">Emails do not match!</small>
                            </div>

                            <div class="floating-group">
                                <i class="fa-solid fa-key icon-inside"></i>
                                <input type="password" id="regPass" class="floating-input" placeholder=" " required
                                    oninput="validateSignupForm()">
                                <label class="floating-label">Password</label>
                                <i class="fa-solid fa-eye eye-toggle" onclick="togglePass('regPass', this)"></i>
                            </div>
                            <div class="floating-group">
                                <i class="fa-solid fa-shield-halved icon-inside"></i>
                                <input type="password" id="regPassConfirm" class="floating-input" placeholder=" "
                                    required oninput="validateSignupForm()">
                                <label class="floating-label">Confirm Password</label>
                                <i class="fa-solid fa-eye eye-toggle" onclick="togglePass('regPassConfirm', this)"></i>
                                <small id="passError" class="error-text">Passwords do not match!</small>
                            </div>

                            <button id="btnDoSignup" onclick="performStudentSignup()"
                                class="btn-modern-action signup-color" disabled>REGISTER & VERIFY</button>

                            <p class="switch-link-center">Already registered? <a href="javascript:void(0)"
                                    onclick="toggleAuthMode('login')">Sign In</a></p>
                        </div>
                    </div>
                </div>
            </div>

            <div id="studentProfileModal" class="profile-overlay">
                <div class="pro-card"
                    style="padding: 0; max-width: 350px; border-radius: 24px; overflow: hidden; background: #fff; font-family: 'Cairo', sans-serif;">

                    <div
                        style="height: 110px; background: linear-gradient(135deg, #0ea5e9, #3b82f6); position: relative;">
                        <button
                            onclick="document.getElementById('infoBtn').style.display='flex'; document.getElementById('studentProfileModal').classList.remove('active'); setTimeout(()=>document.getElementById('studentProfileModal').style.display='none', 300);"
                            style="position: absolute; top: 15px; right: 15px; background: rgba(255,255,255,0.2); border: none; width: 32px; height: 32px; border-radius: 50%; color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(5px);">
                            <i class="fa-solid fa-xmark"></i>
                        </button>
                    </div>

                    <div style="text-align: center; margin-top: -55px; padding-bottom: 10px;">
                        <div class="avatar-wrapper" onclick="openAvatarSelector()"
                            style="margin: 0 auto; width: 100px; height: 100px; position: relative;">
                            <div id="currentAvatar"
                                style="width: 100%; height: 100%; border-radius: 50%; background: #fff; border: 4px solid #fff; display: flex; align-items: center; justify-content: center; font-size: 45px; color: #0ea5e9; box-shadow: 0 10px 20px rgba(0,0,0,0.1);">
                                <i class="fa-solid fa-user"></i>
                            </div>
                            <div class="edit-badge"
                                style="position: absolute; bottom: 5px; right: 0; background: #f8fafc; border: 2px solid #fff; width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; color: #64748b; box-shadow: 0 2px 5px rgba(0,0,0,0.1); cursor: pointer;">
                                <i class="fa-solid fa-pen"></i>
                            </div>
                        </div>

                        <h2 id="profFullName"
                            style="font-size: 18px; font-weight: 800; color: #1e293b; margin: 10px 0 2px 0;"
                            data-i18n="loading_user">Loading...</h2>
                        <p class="pro-role" style="font-size: 12px; color: #64748b; font-weight: 600; margin: 0;"
                            data-i18n="student_role">Nursing Student</p>
                    </div>

                    <div
                        style="display: flex; justify-content: space-around; padding: 15px 20px; border-bottom: 1px solid #f1f5f9;">
                        <div style="text-align: center;">
                            <div style="color: #10b981; font-size: 18px; margin-bottom: 4px;"><i
                                    class="fa-solid fa-calendar-check"></i></div>
                            <div id="profAttendanceVal"
                                style="font-size: 18px; font-weight: 800; color: #0f172a; line-height: 1;">--</div>
                            <div style="font-size: 10px; color: #94a3b8; font-weight: bold; margin-top: 4px;"
                                data-i18n="stat_attendance">Attendance</div>
                        </div>
                        <div style="width: 1px; background: #e2e8f0;"></div>
                        <div style="text-align: center;">
                            <div style="color: #ef4444; font-size: 18px; margin-bottom: 4px;"><i
                                    class="fa-solid fa-calendar-xmark"></i></div>
                            <div id="profAbsenceVal"
                                style="font-size: 18px; font-weight: 800; color: #0f172a; line-height: 1;">--</div>
                            <div style="font-size: 10px; color: #94a3b8; font-weight: bold; margin-top: 4px;"
                                data-i18n="stat_absence">Absence</div>
                        </div>
                        <div style="width: 1px; background: #e2e8f0;"></div>
                        <div style="text-align: center;">
                            <div style="color: #3b82f6; font-size: 18px; margin-bottom: 4px;"><i
                                    class="fa-solid fa-scale-balanced"></i></div>
                            <div id="profDisciplineVal"
                                style="font-size: 14px; font-weight: 800; color: #0f172a; line-height: 1.3;">--</div>
                            <div style="font-size: 10px; color: #94a3b8; font-weight: bold; margin-top: 4px;"
                                data-i18n="stat_discipline">Discipline</div>
                        </div>
                    </div>

                    <div
                        style="background: #fff7ed; padding: 10px 20px; font-size: 10px; color: #c2410c; text-align: center; border-bottom: 1px solid #ffedd5; line-height: 1.5;">
                        <i class="fa-solid fa-circle-info"></i> <b data-i18n="note_title">Note:</b> <span
                            data-i18n="beta_system_msg">Experimental system. Numbers are for review only.</span>
                    </div>

                    <div style="padding: 20px;">

                        <div style="display: flex; gap: 15px; margin-bottom: 15px;">
                            <div
                                style="flex: 1; background: #f8fafc; padding: 10px; border-radius: 12px; display: flex; align-items: center; gap: 10px;">
                                <div
                                    style="width: 35px; height: 35px; background: #e0f2fe; color: #0284c7; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 16px;">
                                    <i class="fa-solid fa-layer-group"></i>
                                </div>
                                <div>
                                    <div style="font-size: 9px; color: #64748b;" data-i18n="academic_level_label">Level
                                    </div>
                                    <div id="profLevel" style="font-size: 12px; font-weight: 700; color: #1e293b;">--
                                    </div>
                                </div>
                            </div>
                            <div
                                style="flex: 1; background: #f8fafc; padding: 10px; border-radius: 12px; display: flex; align-items: center; gap: 10px;">
                                <div
                                    style="width: 35px; height: 35px; background: #f3e8ff; color: #7c3aed; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 16px;">
                                    <i class="fa-solid fa-venus-mars"></i>
                                </div>
                                <div>
                                    <div style="font-size: 9px; color: #64748b;" data-i18n="gender_label">Gender</div>
                                    <div id="profGender" style="font-size: 12px; font-weight: 700; color: #1e293b;">--
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            <div
                                style="display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px dashed #e2e8f0;">
                                <span style="font-size: 12px; color: #64748b;">
                                    <i class="fa-solid fa-id-card" style="margin-right:5px;"></i> <span
                                        data-i18n="university_id_label">University ID</span>
                                </span>
                                <span id="profStudentID" class="en-font"
                                    style="font-size: 14px; font-weight: 700; color: #0f172a; letter-spacing: 1px;">--</span>
                            </div>

                            <div
                                style="display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px dashed #e2e8f0;">
                                <span style="font-size: 12px; color: #64748b;">
                                    <i class="fa-solid fa-envelope" style="margin-right:5px;"></i> <span
                                        data-i18n="official_email_label">Official Email</span>
                                </span>
                                <span id="profEmail" class="en-font"
                                    style="font-size: 11px; font-weight: 600; color: #334155; max-width: 180px; overflow: hidden; text-overflow: ellipsis;">--</span>
                            </div>
                        </div>

                        <div
                            style="margin-top: 15px; padding: 10px; background: #fef2f2; border-radius: 12px; border: 1px dashed #fca5a5; text-align: center;">

                            <div
                                style="display: flex; align-items: center; justify-content: center; gap: 6px; color: #b91c1c; font-size: 11px; font-weight: 700; margin-bottom: 5px;">
                                <i class="fa-solid fa-triangle-exclamation"></i>
                                <span data-i18n="device_warning_msg">Warning: This account is permanently linked to your
                                    device.</span>
                            </div>

                            <div
                                style="display:flex; align-items:center; justify-content:center; gap:4px; font-size: 9px; color: #7f1d1d;">
                                <span data-i18n="system_id_label">System ID:</span>
                                <span id="profUID" class="en-font" style="opacity: 0.7;">--</span>
                            </div>
                        </div>

                        <button onclick="performLogout()"
                            style="margin-top: 20px; width: 100%; padding: 12px; background: #fee2e2; color: #ef4444; border: none; border-radius: 12px; font-weight: 700; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; transition: 0.2s;">
                            <span data-i18n="sign_out">Sign Out</span> <i
                                class="fa-solid fa-arrow-right-from-bracket"></i>
                        </button>

                    </div>
                </div>
            </div>
            <div id="avatarSelectorModal" class="profile-overlay" style="z-index: 2147483647;">
                <div class="pro-card" style="max-width: 340px; padding-top: 20px;">

                    <h3 class="pro-name" style="font-size: 18px; margin-bottom: 5px;" data-i18n="choose_avatar_title">
                        اختر صورتك الرمزية</h3>
                    <p class="pro-role" style="margin-bottom: 20px;" data-i18n="choose_avatar_sub">اختر أيقونة تمثلك
                        في
                        النظام</p>

                    <div id="avatarsGrid" class="avatars-grid-modern"></div>

                    <button onclick="document.getElementById('avatarSelectorModal').style.display='none'"
                        class="btn-logout-pro" style="background: #f1f5f9; color: #64748b; margin-top: 20px;"
                        data-i18n="cancel_btn">
                        إلغاء
                    </button>
                </div>
            </div>
            <div id="unifiedProfileBtn" class="modern-profile-trigger" onclick="handleProfileIconClick()">
                <div class="profile-glow-ring"></div>
                <div class="profile-inner-container" id="profileIconWrapper">
                    <i class="fa-solid fa-user-astronaut" id="profileIconImg"></i>
                    <div class="status-indicator" id="userStatusDot"></div>
                </div>
            </div>
            <style>
                #facultyProfileBtn {
                    background: none !important;
                    border: none !important;
                    box-shadow: none !important;
                    padding: 0 !important;
                    width: 80px !important;
                    height: 80px !important;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 9999;
                }

                #facultyProfileBtn .trigger-avatar-wrapper {
                    width: 65px !important;
                    height: 65px !important;
                    background: linear-gradient(135deg, #0ea5e9, #0284c7);
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    border: 3px solid #fff;
                    box-shadow: 0 6px 20px rgba(14, 165, 233, 0.4);
                    position: relative;
                    transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
                }

                #facultyProfileBtn .trigger-avatar-wrapper i {
                    color: white !important;
                    font-size: 30px !important;
                }

                #facultyProfileBtn::after {
                    display: none !important;
                    content: none !important;
                }

                #facultyProfileBtn:active .trigger-avatar-wrapper {
                    transform: scale(0.9);
                }
            </style>

            <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

</body>

</html>
<style>
    .faculty-modal.modal-overlay {
        background: rgba(15, 23, 42, 0.5);
        backdrop-filter: blur(15px);
        -webkit-backdrop-filter: blur(15px);
        display: none;
        align-items: center;
        justify-content: center;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 999999;
    }

    .faculty-modal .modal-box {
        background: rgba(255, 255, 255, 0.15);
        backdrop-filter: blur(30px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        box-shadow: 0 40px 80px rgba(0, 0, 0, 0.4);
        border-radius: 25px;
        width: 95%;
        max-width: 450px;
        color: #fff;
    }

    .input-group {
        position: relative;
        margin-bottom: 22px;
        width: 100%;
    }

    .modern-input {
        width: 100% !important;
        background: transparent !important;
        border: 1.5px solid rgba(255, 255, 255, 0.3) !important;
        padding: 15px 18px;
        border-radius: 12px;
        color: #fff !important;
        outline: none;
        box-sizing: border-box;
        font-size: 14px;
        transition: all 0.3s ease;
    }

    .modern-input-pass {
        padding-right: 55px !important;
    }

    .input-group label {
        position: absolute;
        top: 50%;
        left: 15px;
        transform: translateY(-50%);
        font-size: 14px;
        color: rgba(255, 255, 255, 0.6);
        pointer-events: none;
        transition: all 0.2s ease;
        padding: 0 8px;
        background: transparent;
    }

    .modern-input:focus~label,
    .modern-input:not(:placeholder-shown)~label,
    .input-group.has-value label {
        top: 0;
        font-size: 12px;
        color: #fff;
        font-weight: 600;
        background: #2e384d;
        border-radius: 4px;
    }

    .modern-input:focus {
        border-color: #fff !important;
        box-shadow: 0 0 0 4px rgba(255, 255, 255, 0.05);
    }

    select.modern-input option {
        background: #1e293b;
        color: #fff;
    }

    .password-wrapper {
        position: relative;
        width: 100%;
    }

    .toggle-eye {
        position: absolute;
        right: 18px;
        top: 50%;
        transform: translateY(-50%);
        cursor: pointer;
        color: rgba(255, 255, 255, 0.5);
        z-index: 20;
        font-size: 18px;
        display: flex;
        align-items: center;
        height: 100%;
    }

    #facMasterKey {
        text-align: center;
        letter-spacing: 2px;
        font-weight: 800;
        background: rgba(255, 255, 255, 0.1) !important;
        border: 1.5px dashed rgba(255, 255, 255, 0.4) !important;
        color: #fff !important;
        text-transform: uppercase;
    }

    .glass-btn-submit {
        width: 100%;
        height: 55px;
        background: #fff;
        color: #0f172a;
        border: none;
        border-radius: 15px;
        font-weight: 800;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
        transition: 0.3s;
    }

    .signup-scroll-area {
        max-height: 480px;
        overflow-y: auto;
        padding: 10px 5px;
    }
</style>

<div id="facultyGateModal" class="modal-overlay faculty-modal">
    <div class="modal-box">

        <div style="display: flex; border-bottom: 1px solid rgba(255,255,255,0.1);">
            <button id="tabLogin" onclick="switchFacultyTab('login')" class="faculty-tab active"
                style="flex:1; border:none; padding:20px; background:transparent; color:#fff; font-weight:bold; cursor:pointer;">LOGIN</button>
            <button id="tabSignup" onclick="switchFacultyTab('signup')" class="faculty-tab"
                style="flex:1; border:none; padding:20px; background:transparent; color:rgba(255,255,255,0.5); cursor:pointer;">REGISTER</button>
        </div>

        <div style="padding: 30px;">
            <div id="facultySignupSection" style="display: none;">
                <div class="signup-scroll-area">
                    <div class="input-group">
                        <input type="text" id="facName" class="modern-input" placeholder=" ">
                        <label>Full Name (Triple)</label>
                    </div>

                    <div class="input-group has-value">
                        <select id="facRole" class="modern-input">
                            <option value="doctor">Faculty Member / Doctor</option>
                            <option value="dean">Vice Dean / Dean</option>
                        </select>
                        <label>Position / Role</label>
                    </div>

                    <div class="input-group has-value">
                        <select id="facGender" class="modern-input">
                            <option value="" disabled selected>Select Gender</option>
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                        </select>
                        <label>Gender</label>
                    </div>

                    <div class="input-group">
                        <input type="text" id="facJobTitle" class="modern-input" placeholder=" ">
                        <label>Job Title</label>
                    </div>

                    <div class="input-group">
                        <input type="email" id="facEmail" class="modern-input" placeholder=" ">
                        <label>Email Address</label>
                    </div>

                    <div class="input-group">
                        <input type="email" id="facEmailConfirm" class="modern-input" placeholder=" ">
                        <label>Confirm Email</label>
                    </div>

                    <div class="input-group password-wrapper">
                        <input type="password" id="facPass" class="modern-input modern-input-pass" placeholder=" ">
                        <label>Password</label>
                        <i class="fa-solid fa-eye toggle-eye" onclick="togglePasswordVisibility('facPass', this)"></i>
                    </div>

                    <div class="input-group password-wrapper">
                        <input type="password" id="facPassConfirm" class="modern-input modern-input-pass"
                            placeholder=" ">
                        <label>Confirm Password</label>
                        <i class="fa-solid fa-eye toggle-eye"
                            onclick="togglePasswordVisibility('facPassConfirm', this)"></i>
                    </div>

                    <div
                        style="background: rgba(255, 255, 255, 0.05); padding: 20px; border-radius: 20px; border: 1.5px dashed rgba(255,255,255,0.2);">
                        <div class="input-group" style="margin-bottom: 0;">
                            <input type="text" id="facMasterKey" class="modern-input" placeholder=" "
                                autocomplete="off">
                            <label
                                style="left: 50%; transform: translate(-50%, -50%); width: 100%; text-align: center;">Master
                                Key (Authorization Code)</label>
                        </div>
                    </div>
                </div>

                <button onclick="performFacultySignup()" class="glass-btn-submit" style="margin-top: 25px;">
                    <i class="fa-solid fa-user-plus"></i> CREATE ACCOUNT
                </button>
            </div>

            <div id="facultyLoginSection">
                <div class="input-group">
                    <input type="email" id="facLoginEmail" class="modern-input" placeholder=" ">
                    <label>Email Address</label>
                </div>
                <div class="input-group password-wrapper">
                    <input type="password" id="facLoginPass" class="modern-input modern-input-pass" placeholder=" ">
                    <label>Password</label>
                    <i class="fa-solid fa-eye toggle-eye" onclick="togglePasswordVisibility('facLoginPass', this)"></i>
                </div>
                <button onclick="performFacultyLogin()" class="glass-btn-submit">
                    SIGN IN <i class="fa-solid fa-lock-open"></i>
                </button>
            </div>
        </div>

        <button onclick="document.getElementById('facultyGateModal').style.display='none'"
            style="width:100%; background:transparent; border:none; color:rgba(255,255,255,0.4); padding:20px; cursor:pointer; font-size:12px;">DISMISS</button>
    </div>
</div>

<style>
    .fac-tab {
        flex: 1;
        padding: 15px;
        border: none;
        background: none;
        font-weight: 800;
        color: #94a3b8;
        cursor: pointer;
        transition: 0.3s;
        font-family: 'Cairo', sans-serif;
    }

    .fac-tab.active {
        color: #0f172a;
        border-bottom: 3px solid #0f172a;
        background: white;
    }

    .modern-input:focus {
        border-color: #0f172a;
        box-shadow: 0 0 0 3px rgba(15, 23, 42, 0.1);
    }

    #customTimeModal .modern-input {
        background-color: #ffffff !important;
        color: #1e293b !important;
        border: 1.5px solid #cbd5e1 !important;
        padding: 12px !important;
    }

    #modalSubjectSelect,
    #modalHallSelect {
        color: #1e293b !important;
        font-weight: 700 !important;
    }

    #modalSessionPassInput,
    #modalMaxStudents {
        color: #0f172a !important;
        background: #f8fafc !important;
    }

    #customTimeModal select option {
        color: #1e293b !important;
        background-color: #fff !important;
        padding: 10px;
    }

    #customTimeModal .modern-input::placeholder {
        color: #94a3b8 !important;
        opacity: 1;
    }
</style>
<div id="facultyProfileModal" class="modal-overlay faculty-modal" style="z-index: 2147483646;">
    <div class="modal-box" style="max-width: 400px; text-align: center; padding-bottom: 20px;">

        <div
            style="padding: 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid rgba(255,255,255,0.1);">
            <h3 style="margin: 0; font-size: 18px; letter-spacing: 1px; color: white;">Admin Profile</h3>
            <button onclick="document.getElementById('facultyProfileModal').style.display='none'"
                style="background: none; border: none; color: #fff; cursor: pointer; font-size: 20px;">&times;</button>
        </div>

        <div style="padding: 30px 20px;">
            <div style="position: relative; display: inline-block; margin-bottom: 20px;">
                <div id="facCurrentAvatar" class="profile-avatar-circle"
                    style="width: 100px; height: 100px; font-size: 45px; border: 3px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #fff;">
                    <i class="fa-solid fa-user-doctor"></i>
                </div>
                <button onclick="openAvatarSelector('faculty')"
                    style="position: absolute; bottom: 0; right: 0; width: 32px; height: 32px; border-radius: 50%; background: #0ea5e9; border: 2px solid #fff; color: #fff; cursor: pointer; font-size: 14px;">
                    <i class="fa-solid fa-camera"></i>
                </button>
            </div>

            <h2 id="profFacName" style="margin: 0; font-size: 22px; font-weight: 800; color: white;">Loading...</h2>
            <p id="profFacRole"
                style="margin: 5px 0 20px 0; color: rgba(255,255,255,0.6); font-size: 14px; text-transform: uppercase; letter-spacing: 2px;">
                Faculty Member</p>

            <div
                style="text-align: left; background: rgba(0,0,0,0.2); border-radius: 20px; padding: 15px; border: 1px solid rgba(255,255,255,0.05);">
                <div style="margin-bottom: 15px;">
                    <label
                        style="display: block; font-size: 10px; color: #0ea5e9; font-weight: 800; margin-bottom: 3px; text-transform: uppercase;">
                        Job Title
                    </label>
                    <span id="profFacSubject" style="font-size: 15px; font-weight: 600; color: white;">--</span>
                </div>
                <div style="margin-bottom: 15px;">
                    <label
                        style="display: block; font-size: 10px; color: #0ea5e9; font-weight: 800; margin-bottom: 3px; text-transform: uppercase;">
                        Email Address
                    </label>
                    <span id="profFacEmail"
                        style="font-size: 13px; font-family: 'Courier New', Courier, monospace; color: white;">--</span>
                </div>
                <div>
                    <label
                        style="display: block; font-size: 10px; color: #0ea5e9; font-weight: 800; margin-bottom: 3px; text-transform: uppercase;">
                        System ID
                    </label>
                    <span id="profFacUID" style="font-size: 11px; opacity: 0.5; color: white;">--</span>
                </div>
            </div>
        </div>

        <button onclick="performLogout()"
            style="width: 80%; background: rgba(239, 68, 68, 0.15); color: #ef4444; border: 1px solid #ef4444; padding: 12px; border-radius: 12px; font-weight: 700; cursor: pointer; transition: 0.3s;">
            <i class="fa-solid fa-right-from-bracket"></i> SIGN OUT
        </button>
    </div>
</div>
<style>
    #screenLiveSession {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #f8fafc;
        z-index: 2147483647;
        display: none;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start !important;
        padding: 10px 10px 0 10px;
        overflow-y: auto;
        pointer-events: auto !important;
        touch-action: auto !important;
    }

    .live-top-bar {
        width: 100%;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 5px 15px;
        background: transparent;
        position: relative;
        z-index: 10;
        margin-bottom: 5px;
    }

    .home-floating-btn {
        position: static !important;
        transform: none !important;
        margin: 0 !important;
        width: 45px;
        height: 45px;
        background: #ffffff;
        border-radius: 14px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        border: 1px solid #e2e8f0;
        color: #334155;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .home-floating-btn:active {
        transform: scale(0.9);
    }

    .live-pill {
        background: #fee2e2;
        color: #ef4444;
        padding: 8px 18px;
        border-radius: 30px;
        font-size: 11px;
        font-weight: 800;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        border: 1px solid #fecaca;
        box-shadow: 0 4px 12px rgba(239, 68, 68, 0.1);
        font-family: 'Outfit', sans-serif;
        letter-spacing: 0.5px;
    }

    .pulse {
        width: 8px;
        height: 8px;
        background: #ef4444;
        border-radius: 50%;
        animation: blink 1s infinite;
    }

    @keyframes blink {
        50% {
            opacity: 0.4;
        }
    }

    .royal-card {
        background: #ffffff;
        width: 98%;
        border-radius: 24px;
        box-shadow: 0 20px 60px -10px rgba(14, 165, 233, 0.15);
        border: 1px solid rgba(255, 255, 255, 0.8);
        position: relative;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        margin-top: 0 !important;
    }

    .royal-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 6px;
        height: 100%;
        background: linear-gradient(to bottom, #0ea5e9, #3b82f6);
    }

    .royal-header {
        display: flex;
        flex-direction: row;
        align-items: center;
        padding: 20px;
        gap: 15px;
        direction: ltr;
    }

    .royal-avatar-box {
        width: 70px;
        height: 70px;
        background: #f0f9ff;
        border-radius: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 35px;
        color: #0284c7;
        border: 2px solid #bae6fd;
        box-shadow: 0 5px 15px rgba(14, 165, 233, 0.15);
        flex-shrink: 0;
    }

    .royal-text {
        text-align: left;
        flex: 1;
    }

    .r-name {
        font-size: 20px;
        font-weight: 900;
        color: #0f172a;
        margin-bottom: 5px;
        display: block;
        font-family: 'Outfit', sans-serif;
    }

    .r-sub {
        font-size: 13px;
        color: #0ea5e9;
        font-weight: 700;
        background: #f0f9ff;
        padding: 5px 15px;
        border-radius: 8px;
        display: inline-block;
        font-family: 'Outfit', sans-serif;
    }

    .royal-stats {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        padding: 15px 0;
        background: #fafafa;
        border-top: 1px solid #f1f5f9;
        direction: ltr;
    }

    .r-stat {
        text-align: center;
        border-right: 1px solid #e2e8f0;
    }

    .r-stat:last-child {
        border-right: none;
    }

    .rs-label {
        display: block;
        font-size: 10px;
        color: #94a3b8;
        font-weight: 800;
        margin-bottom: 4px;
        text-transform: uppercase;
    }

    .rs-val {
        font-size: 18px;
        font-weight: 900;
        color: #334155;
        font-family: 'Outfit', sans-serif;
    }

    .rs-val.green {
        color: #10b981;
    }

    .rs-val.blue {
        color: #0ea5e9;
    }

    .bottom-action-area {
        width: 100%;
        background: #ffffff;
        padding: 15px 15px 25px 15px;
        border-top: 1px solid #e2e8f0;
        display: flex;
        flex-direction: column;
        gap: 10px;
        justify-content: center;
        box-shadow: 0 -10px 30px rgba(0, 0, 0, 0.03);
        margin-top: auto;
    }

    .btn-end-session-eng {
        background: linear-gradient(135deg, #ef4444, #b91c1c);
        color: white;
        border: none;
        width: 100%;
        padding: 15px;
        border-radius: 18px;
        font-weight: 800;
        font-size: 15px;
        box-shadow: 0 12px 25px rgba(239, 68, 68, 0.3);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
        transition: transform 0.2s;
        font-family: 'Outfit', sans-serif;
        text-transform: uppercase;
    }

    .btn-end-session-eng:active {
        transform: scale(0.96);
    }

    .live-students-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(175px, 1fr));
        gap: 15px;
        width: 100%;
        padding: 15px;
        padding-bottom: 50px;
    }

    .action-buttons-row {
        display: flex;
        justify-content: center;
        gap: 8px;
        margin-top: 10px;
        border-top: 1px solid #f1f5f9;
        padding-top: 8px;
        width: 100%;
    }

    .mini-action-btn {
        width: 32px;
        height: 32px;
        border-radius: 8px;
        border: none;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.2s;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
    }

    .search-floating-wrapper {
        position: relative;
        width: 95%;
        margin: 10px auto;
        z-index: 5;
    }

    .modern-search-input {
        width: 100%;
        padding: 12px 50px 12px 20px;
        border-radius: 16px;
        border: 1px solid #e2e8f0;
        background: #ffffff;
        font-family: 'Outfit', sans-serif;
        font-size: 14px;
        font-weight: 600;
        color: #1e293b;
        outline: none;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.03);
    }

    .modern-search-input:focus {
        border-color: #0ea5e9;
        box-shadow: 0 0 0 4px rgba(14, 165, 233, 0.1);
    }

    .search-icon-box {
        position: absolute;
        right: 15px;
        top: 50%;
        transform: translateY(-50%);
        color: #94a3b8;
        font-size: 16px;
        pointer-events: none;
    }
</style>

<div id="screenLiveSession" style="display: none;">

    <div class="live-top-bar">
        <div class="live-pill" id="liveStatusPill">
            <span class="pulse"></span>
            <span id="liveStatusText" data-i18n="live_status_active">الجلسة نشطة حالياً</span>
        </div>

        <button class="home-floating-btn" onclick="goHome()" title="Exit">
            <i class="fa-solid fa-house"></i>
        </button>
    </div>

    <div
        style="width: 100%; flex: 1; display: flex; flex-direction: column; align-items: center; overflow-y: auto; padding-bottom: 20px;">

        <div class="royal-card">
            <div class="royal-header">
                <div class="royal-avatar-box" id="liveDocAvatar">
                    <i class="fa-solid fa-user-doctor"></i>
                </div>
                <div class="royal-text">
                    <span class="r-name" id="liveDocName" data-i18n="loading_text">جاري التحميل...</span>
                    <div style="display: flex; gap: 5px; align-items: center; flex-wrap: wrap;">
                        <span class="r-sub" id="liveSubjectTag" data-i18n="subject_label">اسم المادة</span>
                        <span id="liveGroupTag" onclick="openGroupManager()"
                            style="cursor: pointer; background: #eef2ff; color: #6366f1; padding: 2px 10px; border-radius: 6px; font-size: 11px; font-weight: 800; border: 1px solid #c7d2fe;">
                            المجموعة: --
                        </span>
                    </div>
                    <div id="liveHallTag" style="font-size: 12px; color: #64748b; margin-top: 4px; font-weight: bold;">
                        <i class="fa-solid fa-building-columns"></i> <span data-i18n="hall_label">القاعة</span>
                    </div>
                </div>
            </div>

            <div class="royal-stats"
                style="grid-template-columns: repeat(2, 1fr); gap: 10px; padding: 15px; background: #f8fafc;">

                <div class="r-stat"
                    style="border: none; background: white; border-radius: 15px; padding: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.02);">
                    <span class="rs-label" data-i18n="present_count_label">الحاضرين</span>
                    <span id="livePresentCount" class="rs-val green">0</span>
                </div>

                <div class="r-stat" id="doorControlBtn" onclick="openDoorActionModal()"
                    style="cursor: pointer; border: 1.5px dashed #0ea5e9; border-radius: 15px; background: #f0f9ff; padding: 10px; transition: 0.3s;">
                    <span class="rs-label" style="color: #0284c7;" data-i18n="entrance_gate_label">بوابة الدخول</span>
                    <span id="doorStatusText" class="rs-val blue" style="font-size: 16px;"
                        data-i18n="gate_closed_status">
                        <i class="fa-solid fa-door-closed"></i> مغلقة
                    </span>
                </div>

                <div class="r-stat" id="codeStatBlock"
                    style="border: none; background: white; border-radius: 15px; padding: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.02);">
                    <span class="rs-label" data-i18n="session_code_label">كود الجلسة</span>
                    <span id="liveSessionCodeDisplay" class="rs-val" style="letter-spacing: 2px;">------</span>
                </div>

                <div class="r-stat" id="extraStatBlock"
                    style="border: none; background: white; border-radius: 15px; padding: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.02);">
                    <span class="rs-label" data-i18n="extra_count_label">إضافي</span>
                    <span id="liveExtraCount" class="rs-val" style="color: #94a3b8;">0</span>
                </div>
            </div>
        </div>

        <div class="search-floating-wrapper">
            <input type="text" id="liveSearchInput" class="modern-search-input"
                data-i18n-placeholder="live_search_placeholder" placeholder="بحث بالاسم أو الكود..."
                onkeyup="filterLiveStudents()">
            <div class="search-icon-box">
                <i class="fa-solid fa-magnifying-glass"></i>
            </div>
        </div>

        <div id="liveStudentsGrid" class="live-students-grid" style="width: 100%; padding: 10px;"></div>
    </div>

    <style>
        .live-fab-container {
            position: fixed;
            bottom: 25px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            z-index: 2000;
            pointer-events: auto;
            align-items: center;
        }

        .live-fab-btn {
            width: 55px;
            height: 55px;
            border-radius: 50%;
            border: 2px solid white;
            color: white;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.25);
            cursor: pointer;
            transition: transform 0.2s;
        }

        .fab-add {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .fab-end {
            background: linear-gradient(135deg, #ef4444, #b91c1c);
        }
    </style>

    <div class="live-fab-container" id="adminFabControls" style="display: flex;">
        <button onclick="triggerSessionEndOptions()" class="live-fab-btn fab-end" title="إنهاء الجلسة">
            <i class="fa-solid fa-power-off"></i>
        </button>

        <button onclick="document.getElementById('manualAddModal').style.display='flex'" class="live-fab-btn fab-add"
            title="إضافة طالب">
            <i class="fa-solid fa-user-plus"></i>
        </button>
    </div>
</div>
<div id="manualAddModal" class="modal-overlay" style="z-index: 2147483647;">
    <div class="modal-box" style="text-align: center; max-width: 320px; padding: 25px;">

        <div
            style="background: #f0fdf4; width: 70px; height: 70px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px auto; border: 1px solid #dcfce7;">
            <i class="fa-solid fa-user-plus" style="font-size: 30px; color: #16a34a;"></i>
        </div>
        <h3 style="color: #1e293b; margin-bottom: 5px; font-weight: 900;" data-i18n="manual_add_title">إضافة طالب يدوياً
        </h3>

        <div id="manualInputStep">
            <p style="color: #64748b; font-size: 13px; margin-bottom: 20px;" data-i18n="manual_search_hint">أدخل كود
                الطالب للبحث عنه في قاعدة البيانات.</p>

            <div class="input-group" style="margin-bottom: 15px;">
                <input type="number" id="manualStudentCodeInput" class="modern-input" placeholder=" "
                    style="text-align: center; color: #0f172a !important; border-color: #cbd5e1 !important; font-weight: bold; font-family: 'Outfit', sans-serif;">
                <label style="color: #64748b; left: 50%; transform: translate(-50%, -50%);"
                    data-i18n="student_id_label">كود الطالب (ID)</label>
            </div>

            <button onclick="searchManualStudent()" class="btn-main"
                style="background: #0f172a; width: 100%; margin-bottom: 10px;">
                <span data-i18n="search_btn">بحث</span> <i class="fa-solid fa-magnifying-glass"></i>
            </button>
        </div>

        <div id="manualConfirmStep" style="display: none; animation: fadeIn 0.3s;">

            <div
                style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 16px; padding: 15px; margin-bottom: 15px; margin-top: 10px;">
                <div
                    style="width: 60px; height: 60px; border-radius: 50%; background: #fff; border: 2px solid #0ea5e9; margin: 0 auto 10px auto; display: flex; align-items: center; justify-content: center; font-size: 25px; color: #0ea5e9;">
                    <i class="fa-solid fa-user-graduate"></i>
                </div>
                <div id="previewStudentName"
                    style="font-weight: 900; color: #0f172a; font-size: 14px; margin-bottom: 5px;">--</div>
                <div id="previewStudentID" class="en-font"
                    style="font-size: 12px; color: #64748b; background: #e2e8f0; padding: 2px 10px; border-radius: 10px; display: inline-block;">
                    --</div>
            </div>

            <button id="btnConfirmManualAdd" onclick="confirmManualAdd()" class="btn-main"
                style="background: #16a34a; width: 100%; margin-bottom: 10px; box-shadow: 0 4px 15px rgba(22, 163, 74, 0.3);">
                <span data-i18n="confirm_add_btn">تأكيد الإضافة</span> <i class="fa-solid fa-check"></i>
            </button>
        </div>

        <button onclick="resetManualModal()" class="btn-cancel-modern" style="width: 100%;"
            data-i18n="cancel_btn">إلغاء</button>
    </div>
</div>
<div id="dailyWelcomeModal" class="modal-overlay" style="z-index: 2147483647; display: none;"
    onclick="closeDailyWelcome()">
    <div class="modal-box modern-glass-popup" onclick="event.stopPropagation(); closeDailyWelcome();">
        <div class="welcome-icon-circle"><i class="fa-solid fa-face-smile-beam"></i></div>
        <h2 class="welcome-title"><span data-i18n="hi_text">أهلاً</span>، <span id="welcomeUserName">Student</span>! 😊
        </h2>
        <div class="welcome-divider"></div>
        <p class="welcome-text">
            <span data-i18n="glad_here_text">سعداء بوجودك معنا اليوم.</span><br>
            <span data-i18n="better_than_yesterday">لنكن أفضل مما كنا عليه بالأمس!</span> ✨
        </p>
        <button onclick="closeDailyWelcome()" class="btn-main welcome-btn" data-i18n="lets_go_btn">هيا بنا</button>
    </div>
</div>

<div id="studentAuthDrawer" class="auth-drawer-overlay" onclick="if(event.target == this) closeAuthDrawer()">
    <div class="auth-drawer-content modern-glass">
        <button onclick="closeAuthDrawer()" class="close-btn-modern"><i class="fa-solid fa-xmark"></i></button>
        <div class="header-content-center">
            <h2 id="authTitle" class="auth-main-title" data-i18n="welcome_back_title">مرحباً بعودتك</h2>
            <p id="authSubtitle" class="auth-sub-title" data-i18n="welcome_nursing_sub">انضم إلى مجتمع التمريض الخاص بنا
                بالأسفل</p>
        </div>
        <div class="drawer-body">

        </div>
    </div>
</div>
<div id="doorDurationModal" class="modal-overlay" style="z-index: 2147483647; display: none;">
    <div class="modal-box" style="max-width: 350px; border-radius: 30px;">
        <div
            style="background: #fff7ed; width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px auto;">
            <i class="fa-solid fa-door-open" style="color: #ea580c; font-size: 25px;"></i>
        </div>
        <h3 style="font-weight: 900; color: #1e293b;" data-i18n="open_gate_title">فتح باب تسجيل الحضور</h3>
        <p style="font-size: 13px; color: #64748b;" data-i18n="door_hint">سيتم توليد كود جديد الآن. حدد مدة فتح الباب
            للطلاب:</p>

        <div class="sys-time-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 20px 0;">
            <button onclick="confirmOpenDoor(60)" class="sys-time-btn" data-i18n="time_1m">دقيقة واحدة</button>
            <button onclick="confirmOpenDoor(180)" class="sys-time-btn" data-i18n="time_3m">3 دقائق</button>
            <button onclick="confirmOpenDoor(300)" class="sys-time-btn" data-i18n="time_5m">5 دقائق</button>
            <button onclick="confirmOpenDoor(600)" class="sys-time-btn" data-i18n="time_10m">10 دقائق</button>
            <button onclick="confirmOpenDoor(-1)" class="sys-time-btn sys-infinite" style="grid-column: span 2;"
                data-i18n="open_time">🔓 وقت مفتوح</button>
        </div>

        <button onclick="document.getElementById('doorDurationModal').style.display='none'" class="btn-cancel-modern"
            style="width:100%;" data-i18n="cancel_btn">إلغاء</button>
    </div>
</div>
<div id="manageGroupsModal" class="modal-overlay" style="z-index: 2147483647; display: none;">
    <style>
        #sessionGroupsList:empty {
            display: none !important;
            padding: 0 !important;
            margin: 0 !important;
        }
    </style>

    <div class="modal-box" style="max-width: 340px; border-radius: 30px;">
        <div class="modal-title"
            style="color: #6366f1; display: flex; align-items: center; justify-content: center; gap: 5px;">
            <i class="fa-solid fa-users-gear"></i>
            <span data-i18n="manage_groups_title">Manage Groups</span>
            <span style="font-size: 11px; color: #ef4444; font-weight: 800;">(e.g. 1G1)</span>
        </div>
        <p style="font-size: 12px; margin-bottom: 15px;" data-i18n="manage_groups_hint">You can add multiple groups to
            this session</p>

        <div style="display: flex; gap: 8px; margin-bottom: 15px;">
            <input type="text" id="newGroupInput" class="modern-input" placeholder=" "
                style="text-align: center; text-transform: uppercase;">
            <button onclick="addNewGroupToSession()" class="btn-main"
                style="width: 60px; margin: 0; border-radius: 12px;">+</button>
        </div>

        <div id="sessionGroupsList"
            style="display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; max-height: 150px; overflow-y: auto; padding: 10px; background: #f8fafc; border-radius: 15px;">
        </div>

        <button onclick="document.getElementById('manageGroupsModal').style.display='none'" class="btn-cancel-modern"
            style="margin-top: 15px;" data-i18n="save_close_btn">Save & Close</button>
    </div>
</div>

<div id="toolsRequestModal" class="modal-overlay" style="z-index: 2147483647; display: none;">
    <div class="modal-box"
        style="max-width: 420px; padding: 0; border-radius: 16px; overflow: hidden; background: white; direction: ltr; text-align: left; font-family: sans-serif;">

        <div
            style="background: linear-gradient(135deg, #16a34a, #15803d); padding: 18px 25px; color: white; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);">
            <h3 style="margin: 0; font-size: 16px; font-weight: 700; display: flex; align-items: center; gap: 8px;">
                <i class="fa-solid fa-briefcase-medical" style="margin-left: 8px;"></i> <span
                    data-i18n="tools_request_title">طلب معدات / أدوات</span>
            </h3>
            <button onclick="document.getElementById('toolsRequestModal').style.display='none'"
                style="background: rgba(255,255,255,0.2); border: none; color: white; width: 32px; height: 32px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.2s;">
                <i class="fa-solid fa-xmark"></i>
            </button>
        </div>

        <div style="padding: 25px;">

            <div style="margin-bottom: 20px;">
                <label style="font-size: 13px; font-weight: 700; color: #374151; display:block; margin-bottom: 8px;"
                    data-i18n="required_tool_label">الأداة / الجهاز المطلوب</label>
                <input type="text" id="reqToolName" data-i18n-placeholder="tool_name_placeholder"
                    placeholder="مثال: جهاز عرض، سماعات..."
                    style="width: 100%; padding: 12px 15px; border-radius: 10px; border: 1px solid #d1d5db; background: #f9fafb; color: #111827; font-weight: 500; font-size: 14px; outline: none; font-family: 'Cairo', sans-serif;">
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">

                <div>
                    <label style="font-size: 13px; font-weight: 700; color: #374151; display:block; margin-bottom: 8px;"
                        data-i18n="quantity_label">الكمية</label>
                    <div
                        style="display: flex; align-items: center; border: 1px solid #d1d5db; border-radius: 10px; overflow: hidden; background: #f9fafb;">
                        <button onclick="changeQty(-1)"
                            style="width: 40px; height: 42px; background: #e5e7eb; border: none; color: #374151; cursor: pointer; font-size: 16px; border-right: 1px solid #d1d5db;">-</button>
                        <input type="number" id="reqToolQty" value="1" min="1" readonly
                            style="flex: 1; height: 42px; text-align: center; border: none; background: transparent; color: #111827; font-weight: 700; font-size: 16px; width: 50px;">
                        <button onclick="changeQty(1)"
                            style="width: 40px; height: 42px; background: #e5e7eb; border: none; color: #16a34a; cursor: pointer; font-size: 16px; border-left: 1px solid #d1d5db;">+</button>
                    </div>
                </div>

                <div>
                    <label style="font-size: 13px; font-weight: 700; color: #374151; display:block; margin-bottom: 8px;"
                        data-i18n="priority_label">الأولوية</label>
                    <div class="segment-control"
                        style="margin: 0; height: 44px; display: flex; background: #f3f4f6; padding: 3px; border-radius: 10px;">

                        <input type="radio" name="urgency" id="urg_normal" value="normal" checked style="display:none;">
                        <label for="urg_normal" onclick="document.getElementById('urg_normal').checked=true"
                            style="flex: 1; display: flex; align-items: center; justify-content: center; border-radius: 8px; font-size: 12px; font-weight: 600; color: #4b5563; cursor: pointer; transition: 0.2s;"
                            data-i18n="priority_normal">
                            عادي
                        </label>

                        <input type="radio" name="urgency" id="urg_high" value="urgent" style="display:none;">
                        <label for="urg_high" onclick="document.getElementById('urg_high').checked=true"
                            style="flex: 1; display: flex; align-items: center; justify-content: center; border-radius: 8px; font-size: 12px; font-weight: 600; color: #ef4444; cursor: pointer; transition: 0.2s;"
                            data-i18n="priority_high">
                            عاجل 🔥
                        </label>
                    </div>
                </div>
            </div>

            <div style="margin-bottom: 20px;">
                <label style="font-size: 13px; font-weight: 700; color: #374151; display:block; margin-bottom: 8px;"
                    data-i18n="needed_time_label">الوقت المطلوب</label>
                <div style="position: relative;">
                    <select id="reqTimingSelect" onchange="toggleTimeInput(this.value)"
                        style="width: 100%; padding: 12px 15px; border-radius: 10px; border: 1px solid #d1d5db; background: #f9fafb; color: #111827; font-size: 14px; font-family: 'Cairo', sans-serif; appearance: none; -webkit-appearance: none;">
                        <option value="now" data-i18n="time_now_option">الآن (المحاضرة الحالية)</option>
                        <option value="later" data-i18n="time_later_option">جدولة لوقت لاحق</option>
                    </select>
                    <i class="fa-solid fa-chevron-down"
                        style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #6b7280; pointer-events: none;"></i>
                </div>

                <div id="reqTimePicker" style="display: none; margin-top: 10px;">
                    <input type="time" id="reqSpecificTime"
                        style="width: 100%; padding: 12px; border-radius: 10px; border: 1px solid #d1d5db; background: #fff; color: #111827;">
                </div>
            </div>

            <div style="margin-bottom: 25px;">
                <label style="font-size: 13px; font-weight: 700; color: #374151; display:block; margin-bottom: 8px;"
                    data-i18n="location_label">الموقع (قاعة / معمل)</label>
                <div style="position: relative;">
                    <select id="reqLocationSelect"
                        style="width: 100%; padding: 12px 15px; border-radius: 10px; border: 1px solid #d1d5db; background: #f9fafb; color: #111827; font-size: 14px; font-weight: 600; font-family: 'Outfit', sans-serif; appearance: none; -webkit-appearance: none;">
                        <option value="" disabled selected data-i18n="select_location_default">-- اختر الموقع --
                        </option>
                    </select>
                    <i class="fa-solid fa-chevron-down"
                        style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #6b7280; pointer-events: none;"></i>
                </div>
            </div>

            <button onclick="submitLogisticsRequest()" class="btn-main"
                style="background: #16a34a; box-shadow: 0 4px 12px rgba(22, 163, 74, 0.4); height: 50px; font-size: 16px; font-weight: 700; width: 100%; border: none; border-radius: 12px; color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px;">
                <span data-i18n="send_request_btn">إرسال الطلب</span> <i class="fa-solid fa-paper-plane"></i>
            </button>

        </div>
    </div>
</div>

<style>
    #urg_normal:checked+label {
        background: #ffffff;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        color: #1f2937 !important;
    }

    #urg_high:checked+label {
        background: #fee2e2;
        box-shadow: 0 1px 3px rgba(239, 68, 68, 0.2);
        color: #b91c1c !important;
    }
</style>
<div id="feedbackModal" class="modal-overlay" style="z-index: 2147483647; display: none;">
    <div class="modal-box" style="text-align: center; max-width: 350px;">
        <div style="margin-bottom: 15px;">
            <div
                style="width: 70px; height: 70px; background: #fffbeb; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto; border: 4px solid #fff;">
                <i class="fa-solid fa-star" style="font-size: 35px; color: #f59e0b;"></i>
            </div>
        </div>

        <h3 class="modal-title" style="color: #1e293b; margin-bottom: 5px;" data-i18n="feedback_title">رأيك يهمنا</h3>

        <p style="color: #64748b; font-size: 13px; margin-bottom: 20px;">
            <span data-i18n="feedback_subtitle">يرجى تقييم محاضرة اليوم للمتابعة:</span><br>
            <b id="feedbackSubjectName" style="color: #0ea5e9; font-size: 15px;">--</b> <br>

            <span style="font-size: 12px; background: #f1f5f9; padding: 2px 8px; border-radius: 6px;">
                <span data-i18n="doctor_prefix">د.</span>
                <span id="feedbackDocName" class="en-font">--</span>
            </span>
        </p>

        <div class="star-rating-container" dir="ltr">
            <i class="fa-solid fa-star star-btn" data-value="1" onclick="selectStar(1)"></i>
            <i class="fa-solid fa-star star-btn" data-value="2" onclick="selectStar(2)"></i>
            <i class="fa-solid fa-star star-btn" data-value="3" onclick="selectStar(3)"></i>
            <i class="fa-solid fa-star star-btn" data-value="4" onclick="selectStar(4)"></i>
            <i class="fa-solid fa-star star-btn" data-value="5" onclick="selectStar(5)"></i>
        </div>

        <div id="ratingText"
            style="font-size: 12px; font-weight: bold; color: #f59e0b; height: 20px; margin-bottom: 10px;"></div>

        <input type="hidden" id="selectedRating" value="0">
        <input type="hidden" id="targetAttendanceDocId" value="">

        <div class="privacy-alert-box">
            <i class="fa-solid fa-user-shield"></i>
            <span data-i18n="privacy_notice_formal">
                تنويه: يتم إرسال هذا التقييم للمحاضر بسرية تامة.
            </span>
        </div>

        <button onclick="submitFeedback()" class="btn-main"
            style="width: 100%; box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3); background: linear-gradient(135deg, #f59e0b, #d97706);">
            <span data-i18n="send_feedback_btn">إرسال التقييم</span> <i class="fa-solid fa-paper-plane"></i>
        </button>
    </div>
</div>

<style>
    .star-rating-container {
        display: flex;
        justify-content: center;
        gap: 12px;
        margin-bottom: 10px;
    }

    .star-btn {
        font-size: 28px;
        color: #e2e8f0;
        cursor: pointer;
        transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275), color 0.2s;
    }

    .star-btn:active {
        transform: scale(0.8);
    }

    .star-btn.active {
        color: #f59e0b;
        transform: scale(1.1);
        text-shadow: 0 0 10px rgba(245, 158, 11, 0.4);
    }

    .privacy-alert-box {
        background-color: #f8fafc;
        border: 1px dashed #cbd5e1;
        border-radius: 12px;
        padding: 10px 15px;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
        text-align: right;
        direction: rtl;
    }

    .privacy-alert-box i {
        color: #10b981;
        font-size: 18px;
        flex-shrink: 0;
    }

    .privacy-alert-box span {
        font-size: 11px;
        color: #64748b;
        line-height: 1.4;
        font-weight: 600;
    }

    .privacy-alert-box strong {
        color: #334155;
    }
</style>
<div id="publicProfileModal" class="modal-overlay" style="z-index: 2147483647 !important;">
    <div class="modal-box social-profile-box extended-card" style="font-family: 'Outfit', 'Cairo', sans-serif;">

        <button onclick="document.getElementById('publicProfileModal').style.display='none'" class="btn-close-absolute">
            <i class="fa-solid fa-xmark"></i>
        </button>

        <div class="social-avatar-wrapper" style="pointer-events: none;">
            <div id="publicAvatar" class="social-avatar-img"></div>
        </div>

        <h2 id="publicName" class="social-name" style="font-family: 'Cairo', sans-serif;">--</h2>
        <div id="publicRoleBadge" class="social-role-badge">--</div>

        <div class="stats-tri-grid">
        </div>

        <div class="social-info-grid">
            <div class="s-info-item">
                <span class="lbl" data-i18n="profile_level">Level / Year</span>
                <span class="val" id="publicLevel">--</span>
            </div>
            <div class="s-info-item">
                <span class="lbl" data-i18n="profile_code">Student ID</span>
                <span class="val en-font" id="publicCode">--</span>
            </div>
        </div>

        <div id="publicExamsSection"
            style="margin-top: 15px; width: 100%; border-top: 1px solid #f1f5f9; padding-top: 10px; display:none;">
            <h4
                style="margin: 0 0 10px 0; font-size: 14px; color: #334155; text-align: left; display: flex; align-items: center; gap: 8px;">
                <i class="fa-solid fa-graduation-cap" style="color: #6366f1;"></i>
                <span data-i18n="exam_results_title">Exam Results</span>
            </h4>
            <div id="publicExamsList" style="display: flex; flex-direction: column; gap: 8px;">
            </div>
        </div>

    </div>
</div>

<div id="imageZoomModal" class="modal-overlay" style="z-index: 2147483665 !important; background: rgba(0,0,0,0.95);"
    onclick="this.style.display='none'">
    <div id="zoomedAvatarContainer" class="zoomed-img-box"></div>
</div>

<style>
    .halo-container-v2 {
        position: absolute !important;
        top: -150px !important;
        left: 50% !important;
        transform: translateX(-50%) !important;
        width: 250px !important;
        height: 100px !important;
        z-index: 50 !important;
        pointer-events: none !important;
    }

    .halo-item {
        position: absolute !important;
        width: 45px !important;
        height: 45px !important;
        border-radius: 50% !important;
        background: #ffffff !important;
        border: 1px solid #e2e8f0 !important;
        box-shadow: 0 5px 15px rgba(14, 165, 233, 0.2) !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        cursor: pointer !important;
        pointer-events: auto !important;
        font-size: 18px !important;
        transition: 0.2s !important;
    }

    .halo-item:active {
        transform: scale(0.9);
    }


    .halo-center {
        top: -76px !important;
        left: -5% !important;
        transform: translateX(-50%) !important;
        z-index: 100 !important;

        background: #ffffff !important;
        color: #0f172a !important;
        font-weight: 900 !important;
        font-size: 12px !important;
        border-color: #0ea5e9 !important;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1) !important;
    }

    .halo-left {
        top: 35px !important;
        left: 20px !important;
        color: #0ea5e9 !important;
    }

    .halo-right {
        top: 35px !important;
        right: 20px !important;
        color: #f59e0b !important;
    }

    .halo-badge-v2 {
        position: absolute;
        top: -3px;
        right: -3px;
        background: #ef4444;
        color: white;
        width: 16px;
        height: 16px;
        border-radius: 50%;
        font-size: 10px;
        font-weight: bold;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 2px solid white;
    }
</style>
<div id="sessionActionModal" class="modal-overlay">
    <div class="modal-box" style="max-width: 400px; text-align: center;">
        <div style="margin-bottom: 20px;">
            <div class="icon-box-large" style="background: #f0f9ff; color: #0ea5e9; margin: 0 auto 15px;">
                <i class="fa-solid fa-pause-circle" style="font-size: 30px;"></i>
            </div>
            <h3 style="color: #0f172a; margin: 0;" data-i18n="session_decisions_title">Session Decisions</h3>
            <p style="color: #64748b; font-size: 13px; margin-top: 5px;" data-i18n="session_decisions_subtitle">
                Has the lecture ended completely or do you want to take a break?
            </p>
        </div>

        <button onclick="performSessionPause()" class="btn-main"
            style="background: linear-gradient(135deg, #f59e0b, #d97706); margin-bottom: 10px;"
            data-i18n="btn_take_break">
            <i class="fa-solid fa-mug-hot"></i> Pause & Resume (Break)
        </button>

        <button onclick="closeSessionImmediately()" class="btn-main" style="background: #ef4444; margin-bottom: 10px;"
            data-i18n="btn_end_session">
            <i class="fa-solid fa-floppy-disk"></i> End & Save
        </button>

        <button onclick="document.getElementById('sessionActionModal').style.display='none'" class="btn-sheet-cancel"
            data-i18n="btn_cancel_close">
            Cancel <i class="fa-solid fa-xmark"></i>
        </button>
    </div>
</div>
<div id="breakModal" class="modal-overlay" style="z-index: 999999999; display: none;">
    <div class="modal-box" style="text-align: center; padding: 30px 20px; border-bottom: 5px solid #f59e0b;">

        <div
            style="background: #fffbeb; width: 90px; height: 90px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px auto; border: 4px solid #fff; box-shadow: 0 4px 6px -1px rgba(245, 158, 11, 0.2);">
            <i class="fa-solid fa-mug-hot" style="font-size: 40px; color: #f59e0b;"></i>
        </div>

        <h2 style="margin: 0; color: #1e293b; font-size: 22px; font-weight: 900; font-family: 'Cairo', sans-serif;">
            استراحة محارب ☕
        </h2>

        <p style="color: #64748b; font-size: 14px; margin: 10px 0 25px 0; line-height: 1.6;">
            تم إيقاف المحاضرة مؤقتاً من قبل الدكتور.<br>
            يرجى الانتظار حتى يتم استئناف الجلسة، ثم <b>أعد الدخول</b>.
        </p>

        <button onclick="location.reload()" class="btn-main"
            style="width: 100%; background: #f59e0b; color: white; box-shadow: 0 4px 15px rgba(245, 158, 11, 0.4);">
            حسناً، العودة للرئيسية
        </button>
    </div>
</div>
<div id="liveFeedbackModal" class="modal-overlay" style="z-index: 2147483650; display: none;">

    <style>
        #liveFeedbackModal .modal-box {
            padding: 0;
            border-radius: 20px;
            overflow: hidden;
            width: 90%;
            max-width: 340px;
            background: #fff;
        }

        .feedback-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: #fffbeb;
            border-bottom: 1px solid #fef3c7;
        }

        .feedback-title {
            font-weight: 800;
            font-size: 16px;
            color: #d97706;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-close-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: white;
            border: 1px solid #e5e7eb;
            color: #9ca3af;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .btn-close-icon:hover {
            background: #fee2e2;
            color: #ef4444;
            border-color: #fecaca;
            transform: rotate(90deg);
        }

        .feedback-body {
            padding: 20px;
            text-align: center;
        }

        .date-badge {
            background: #f3f4f6;
            color: #374151;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
            margin-bottom: 20px;
        }

        .star-row-modern {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }

        .star-label-num {
            width: 30px;
            font-weight: 800;
            font-size: 14px;
            color: #1f2937;
            display: flex;
            align-items: center;
            gap: 2px;
        }

        .progress-track {
            flex: 1;
            height: 10px;
            background: #f3f4f6;
            border-radius: 10px;
            margin: 0 10px;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #fbbf24, #f59e0b);
            border-radius: 10px;
            width: 0%;
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .count-val {
            font-size: 13px;
            font-weight: 600;
            color: #6b7280;
            width: 25px;
            text-align: left;
        }

        .total-box {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px dashed #e5e7eb;
        }

        .total-number {
            font-size: 42px;
            font-weight: 900;
            color: #0f172a;
            line-height: 1;
            font-family: 'Outfit', sans-serif;
        }

        .total-label {
            font-size: 12px;
            color: #9ca3af;
            font-weight: 600;
        }
    </style>

    <div class="modal-box">
        <div class="feedback-header">
            <div class="feedback-title">
                <i class="fa-solid fa-star"></i>
                <span data-i18n="feedback_today_title">Today's Ratings</span>
            </div>
            <button onclick="document.getElementById('liveFeedbackModal').style.display='none'" class="btn-close-icon">
                <i class="fa-solid fa-xmark"></i>
            </button>
        </div>

        <div class="feedback-body">
            <div class="date-badge">
                <i class="fa-regular fa-calendar"></i> <span id="feedbackDateStr" class="en-font">--/--/----</span>
            </div>

            <div id="starsStatsContainer">
                <div style="color:#94a3b8;">
                    <i class="fa-solid fa-circle-notch fa-spin"></i>
                    <span data-i18n="loading_text">Loading...</span>
                </div>
            </div>

            <div class="total-box">
                <div id="totalFeedbackVal" class="total-number">0</div>
                <div class="total-label" data-i18n="total_rated_students">Total Rated Students</div>
            </div>
        </div>
    </div>
</div>
<div id="signupSuccessModal" class="modal-overlay">
    <div class="modal-box" style="text-align: center; padding: 30px;">
        <div
            style="width: 70px; height: 70px; background: #dcfce7; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px;">
            <i class="fa-solid fa-envelope-circle-check fa-bounce" style="font-size: 35px; color: #16a34a;"></i>
        </div>

        <h3 id="successModalTitle" style="font-size: 20px; font-weight: 900; color: #1e293b; margin-bottom: 10px;">
            تم إنشاء الحساب بنجاح!
        </h3>

        <div id="successModalBody" style="font-size: 14px; color: #64748b; line-height: 1.6;">
        </div>

        <button
            onclick="document.getElementById('signupSuccessModal').style.display='none'; openAuthDrawer(); toggleAuthMode('login');"
            class="btn-main" style="width: 100%; margin-top: 25px; justify-content: center;">
            تسجيل الدخول الآن <i class="fa-solid fa-arrow-right-to-bracket"></i>
        </button>
    </div>
</div>
<div id="verificationModal" class="modal-overlay">
    <div class="modal-box" style="text-align: center; padding: 25px;">
        <div
            style="width: 60px; height: 60px; background: #fee2e2; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px;">
            <i class="fa-solid fa-envelope-open-text fa-shake" style="font-size: 30px; color: #ef4444;"></i>
        </div>

        <h3 style="font-size: 18px; font-weight: 800; color: #b91c1c; margin-bottom: 8px;">
            الحساب غير مفعل!
        </h3>

        <p style="font-size: 13px; color: #64748b; margin-bottom: 20px;">
            لقد تم إنشاء حسابك ولكن لم تقم بتفعيله.<br>
            يرجى مراجعة بريدك الإلكتروني والضغط على رابط التفعيل.
        </p>

        <button onclick="document.getElementById('verificationModal').style.display='none';" class="btn-main"
            style="width: 100%; background: #ef4444; border: none;">
            حسناً، سأتحقق الآن <i class="fa-solid fa-check"></i>
        </button>
    </div>
</div>
<div id="expulsionModal" class="modal-overlay" style="z-index: 2147483650 !important;">
    <div class="modal-box" style="text-align: center; padding: 30px; border-top: 5px solid #ef4444;">

        <div
            style="width: 70px; height: 70px; background: #fee2e2; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px;">
            <i class="fa-solid fa-ban fa-beat" style="font-size: 35px; color: #b91c1c;"></i>
        </div>

        <h3 id="expelTitle" style="font-size: 22px; font-weight: 900; color: #b91c1c; margin-bottom: 10px;">
            تم استبعادك!
        </h3>

        <p id="expelBody" style="font-size: 14px; color: #64748b; line-height: 1.6; margin-bottom: 25px;">
            قام المحاضر باستبعادك من الجلسة الحالية.<br>
            لا يمكنك العودة لهذه المحاضرة مرة أخرى.
        </p>

        <button onclick="location.reload()" class="btn-main"
            style="width: 100%; background: #ef4444; border: none; box-shadow: 0 4px 15px rgba(239, 68, 68, 0.4);">
            مغادرة القاعة <i class="fa-solid fa-arrow-right-from-bracket"></i>
        </button>
    </div>
</div>
<div class="floating-refresh-btn" onclick="if(navigator.vibrate) navigator.vibrate(50); location.reload();">
    <i class="fa-solid fa-rotate-right"></i>
</div>
<div id="officialReportTemplate"
    style="position: fixed; top: -9999px; left: -9999px; width: 794px; background: white; z-index: -1;">
    <style>
        .pdf-page {
            width: 100%;
            font-family: 'Cairo', sans-serif;
            direction: rtl;
            text-align: right;
            background: #fff;
            color: #000;
            line-height: 1.5;
        }

        .header-box {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 3px double #000;
            padding-bottom: 15px;
            margin-bottom: 20px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            background: #f8f9fa;
            border: 1px solid #000;
            padding: 10px;
            margin-bottom: 20px;
            font-size: 12px;
            font-weight: bold;
        }

        .section-block {
            margin-bottom: 25px;
            page-break-inside: avoid;
        }

        .section-title {
            background: #1e293b;
            color: #fff;
            padding: 8px 15px;
            font-size: 14px;
            font-weight: bold;
            border-radius: 4px 4px 0 0;
            margin-bottom: 0;
            border: 1px solid #000;
        }

        .main-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 11px;
        }

        .main-table th {
            background-color: #e2e8f0;
            border: 1px solid #000;
            padding: 8px;
            text-align: center;
            font-weight: 900;
        }

        .main-table td {
            border: 1px solid #000;
            padding: 6px;
            text-align: center;
        }

        .main-table tr:nth-child(even) {
            background-color: #f8fafc;
        }

        .summary-box {
            border: 2px solid #000;
            padding: 10px;
            text-align: center;
            font-size: 16px;
            font-weight: bold;
            margin-top: -1px;
            margin-bottom: 20px;
        }

        .signatures {
            margin-top: 50px;
            display: flex;
            justify-content: space-between;
            page-break-inside: avoid;
        }

        .sig-block {
            text-align: center;
            width: 200px;
        }
    </style>

    <div class="pdf-page">

        <div class="header-box">
            <div style="text-align: center;">
                <h3 style="margin:0; font-size:16px;">جامعة الريادة</h3>
                <h4 style="margin:5px 0; font-size:14px;">كلية التمريض</h4>
                <p style="margin:0; font-size:11px;">مكتب العميد</p>
            </div>
            <div style="text-align: left;">
                <h3 style="margin:0; font-size:16px;">تقرير إحصائي رسمي</h3>
                <p style="margin:2px 0; font-size:11px;">التاريخ: <span id="pdfPrintDate">--</span></p>
                <p style="margin:0; font-size:11px;">المرجع: <span id="pdfRefNum">--</span></p>
            </div>
        </div>

        <div class="info-grid">
            <div>بداية الفترة: <span id="pdfDateFrom" style="color:#2563eb">--</span></div>
            <div style="text-align: left;">نهاية الفترة: <span id="pdfDateTo" style="color:#2563eb">--</span></div>
        </div>

        <div class="section-block">
            <div class="section-title">1. المؤشر العام للحضور</div>
            <div class="summary-box">
                إجمالي عدد الطلاب الحاضرين: <span id="pdfTotalAttendance" style="font-size: 22px;">0</span> طالب
            </div>
        </div>

        <div class="section-block">
            <div class="section-title">2. تقرير أداء الهيئة التدريسية</div>
            <table class="main-table">
                <thead>
                    <tr>
                        <th width="40%">اسم الدكتور</th>
                        <th width="30%">عدد المحاضرات</th>
                        <th width="30%">إجمالي حضور الطلاب</th>
                    </tr>
                </thead>
                <tbody id="pdfDoctorsTable"></tbody>
            </table>
        </div>

        <div class="section-block">
            <div class="section-title">3. تقييم الجودة (تنازلياً)</div>
            <table class="main-table">
                <thead>
                    <tr>
                        <th width="10%">#</th>
                        <th width="40%">اسم الدكتور</th>
                        <th width="20%">النسبة</th>
                        <th width="30%">التقدير اللفظي</th>
                    </tr>
                </thead>
                <tbody id="pdfRatingsTable"></tbody>
            </table>
        </div>

        <div class="section-block">
            <div class="section-title" style="background:#b91c1c;">4. سجل المخالفات (سلوك / زي)</div>
            <table class="main-table">
                <thead>
                    <tr>
                        <th>اسم الطالب</th>
                        <th>نوع المخالفة</th>
                        <th>المحاضر</th>
                        <th>التاريخ</th>
                    </tr>
                </thead>
                <tbody id="pdfViolationsTable"></tbody>
            </table>
        </div>

        <div class="section-block">
            <div class="section-title" style="background:#374151;">5. إنذارات الغياب (تجاوز الحد المسموح)</div>
            <table class="main-table">
                <thead>
                    <tr>
                        <th>كود الطالب</th>
                        <th>الاسم الثلاثي</th>
                        <th>أيام الغياب</th>
                    </tr>
                </thead>
                <tbody id="pdfAbsenceTable"></tbody>
            </table>
        </div>

        <div class="signatures">
            <div class="sig-block">
                <p><b>مدير شؤون الطلاب</b></p>
                <br><br>
                <p>....................</p>
            </div>
            <div class="sig-block">
                <p><b>يعتمد، عميد الكلية</b></p>
                <br>
                <p>أ.د/ نجلاء عبدالمنعم</p>
            </div>
        </div>

    </div>
</div>
<div id="superWifiIndicator" class="wifi-status-hidden">
    <div class="wifi-icon-box">
        <i class="fa-solid fa-wifi fa-fade"></i>
        <i class="fa-solid fa-slash wifi-slash" id="wifiSlashIcon"></i>
    </div>
    <span class="wifi-text">System Initializing...</span>
</div>
</body>

</html>